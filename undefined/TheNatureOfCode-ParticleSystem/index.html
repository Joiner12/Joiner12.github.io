<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="脑海中起毛球的记忆" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>The Nature of Code:Particle System |  Wh&#39;s 🛰️ Blogs</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/img/avatar/Jr.ico" />
       
<link rel="stylesheet" href="../../dist/main.css">

      
<link rel="stylesheet" href="../../css/fonts/remixicon.css">

      
<link rel="stylesheet" href="../../css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-TheNatureOfCode-ParticleSystem"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  The Nature of Code:Particle System
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="" class="article-date">
  <time datetime="2022-05-25T07:39:07.000Z" itemprop="datePublished">2022-05-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="../../categories/Processing/">Processing</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">7.5k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">33 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <hr>
<h1 id="粒子系统-Particle-Systems"><a href="#粒子系统-Particle-Systems" class="headerlink" title="粒子系统(Particle Systems)"></a>粒子系统(Particle Systems)</h1><p><a target="_blank" rel="noopener" href="https://natureofcode.com/book/chapter-4-particle-systems/">Click Here Jump To Source Page—The Nature of Code</a></p>
<p>​    粒子系统是由许多单个粒子的集合，所有这些单个粒子的集合用来表示一个模糊的物体。一段时间内，粒子在系统中生成、移动、变化最后消失。粒子系统是一种在计算机图形中非常常见且有用的技术。</p>
<p>​    自 1980 年代初以来，粒子系统已被用于无数视频游戏、动画、数字艺术作品和装置中，用以模拟各种不规则类型的自然现象，例如火、烟、瀑布、雾、草、气泡等。</p>
<p>​    本章重点介绍粒子系统编码的实现。包括：</p>
<ul>
<li>如何组织代码；</li>
<li>在哪里存储单个粒子相关信息而不是整个粒子系统的信息；</li>
<li>…</li>
</ul>
<p>​    虽然本章内容为粒子使用简单的形状和最基本的行为(重力)，但是基于此框架应用更复杂的方式构建粒子和行为，可以实现各种不同的效果。</p>
<span id="more"></span>
<h2 id="为什么需要粒子系统？"><a href="#为什么需要粒子系统？" class="headerlink" title="为什么需要粒子系统？"></a>为什么需要粒子系统？</h2><ol>
<li><p>使用粒子系统能够对例如烟、火、瀑布等已经列出来的自然现象进行建模；</p>
</li>
<li><p>更为抽象的意义就是：使用粒子系统的思路来处理需要面对的大量（<em>many</em>）对象编码过程；之前章节在处理大量对象的过程中使用的是数组的方式来实现，粒子系统能够提供一种超越数组的方式‘；</p>
</li>
<li><p>编写多个类，以及用以保存其他类实例的类编程思想；</p>
<p>粒子系统中，需要更加灵活的处理元素数量的方法，除了编写单个粒子的类之外还要实现一个描述粒子集合的类—粒子系统本身。本章的目标是能够实现如下的程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ParticleSystem ps;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line">  ps.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码中，没有对单个粒子类进行显示引用，但是能够实现整个粒子系统。这是一种非常有用的面向对象编程方式—编写多个类，以及用以保存其他类实例的类。</p>
</li>
<li><p>使用另外两种高级面向对象编程（object-oriented programming）的方法：继承(inheritance )和多态(polymorphism)。</p>
<p>通过继承（和多态），我们将学习一种方便的方法来存储包含不同类型对象的单个列表。 这样，粒子系统不仅需要是单一类型粒子的系统。</p>
</li>
</ol>
<p>​    </p>
<h2 id="单个粒子"><a href="#单个粒子" class="headerlink" title="单个粒子"></a>单个粒子</h2><p>​    粒子系统是由多个粒子组成的，开始实现系统之前，先实现描述单个粒子的类。第二章中的<code>Mover</code>类可以作为一个很好的模板进行使用。实际上粒子是一个能在屏幕上运动的物体。它具有location、velocity、acceleration，一个用以初始化上述变量的结构体，一个用以显示和更新的函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  <span class="comment">//[full] A “Particle” object is just another name for our “Mover.” It has location, velocity, and acceleration.</span></span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    location = l.get();</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector();</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">0</span>);</span><br><span class="line">    fill(<span class="number">175</span>);</span><br><span class="line">    ellipse(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>​    上面为一个最简单的单粒子定义，此外可以添加一个<em>applyfoce()</em>函数控制粒子的运动。添加变量来描述粒子的颜色和形状，或者引用 PImage 来绘制粒子。接下来重点关注一个附加项：<strong><em>生命周期（lifespan）</em></strong>。</p>
<p>​    典型的粒子系统涉及一种称为<strong><em>发射器（emitter）</em></strong>的东西。发射器是粒子的来源，并控制粒子、位置、速度等的初始设置。发射器可能会发射单个粒子爆发，或连续的粒子流，或两者兼而有之。关键是对于这样的典型实现，粒子在发射器处诞生，但不会永远存在。如果它要永远存在，我们的 Processing 草图最终会随着时间的推移随着粒子数量增加到一个难以处理的数字而停止。随着新粒子的诞生，我们需要旧粒子死亡。这会产生无限粒子流的错觉，并且我们的程序的性能不会受到影响。有许多不同的方法可以决定粒子何时死亡。例如，它可能会接触到另一个物体，或者它可能只是离开屏幕。然而，对于我们的第一个粒子类，我们只是要添加一个寿命变量。计时器将从 255 开始并倒计时至 0，此时粒子将被视为“死亡”。所以我们扩展粒子类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="comment">// A new variable to keep track of how long the particle</span></span><br><span class="line">  <span class="comment">// has been “alive”</span></span><br><span class="line">  <span class="keyword">float</span> lifespan; <span class="comment">//[bold]</span></span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    location = l.get();</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector();</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector();</span><br><span class="line">    <span class="comment">// We start at 255 and count down for convenience</span></span><br><span class="line">    lifespan = <span class="number">255</span>; <span class="comment">//[bold]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">    <span class="comment">// Lifespan decreases</span></span><br><span class="line">    lifespan -= <span class="number">2.0</span>; <span class="comment">//[bold]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Since our life ranges from 255 to 0 we can use it for alpha</span></span><br><span class="line">    stroke(<span class="number">0</span>, lifespan); <span class="comment">//[bold]</span></span><br><span class="line">    fill(<span class="number">175</span>, lifespan); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">    ellipse(location.x, location.y, <span class="number">8</span>, <span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询函数</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isDead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Is the particle still alive?</span></span><br><span class="line">    <span class="keyword">if</span> (lifespan &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们选择从 255 开始生命周期并倒计时到 0 的原因是为了方便。 有了这些值，我们也可以指定<em>lifespan</em>来充当椭圆的Alpha 透明度。 当粒子“死”时，它也会在屏幕上消失。</p>
<p>​    加上 <em>lifespan</em> 变量，我们还需要一个额外的函数——一个可以查询（判断真假答案）粒子是”活”还是”死”的函数。 这在我们编写 ParticleSystem 类时会派上用场，该类的任务是管理粒子列表本身。 编写这个函数很容易； 我们只需要检查<em>lifespan</em>的值是否小于0。如果是我们返回<em>true</em>，否则返回<em>false</em>。</p>
<p>验证单粒子运行</p>
<p><code>Particlesystem.pde</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// import</span></span><br><span class="line">Particle singleParticle;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  size(<span class="number">500</span>, <span class="number">500</span>);</span><br><span class="line">  <span class="comment">// initialization single particle</span></span><br><span class="line">  PVector initialPos = <span class="keyword">new</span> PVector(random(width/<span class="number">2</span>-<span class="number">50</span>, width/<span class="number">2</span>+<span class="number">50</span>), <span class="number">0</span>);</span><br><span class="line">  singleParticle = <span class="keyword">new</span> Particle(initialPos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line">  singleParticle.run();</span><br><span class="line">  <span class="keyword">if</span> (singleParticle.isDead()) &#123;</span><br><span class="line">    println(<span class="string">&quot;Particle dead!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>Particle.pde</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="comment">// A new variable to keep track of how long the particle</span></span><br><span class="line">  <span class="comment">// has been “alive”</span></span><br><span class="line">  <span class="keyword">float</span> lifespan; <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    location = l.get();</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>, <span class="number">0.05</span>);</span><br><span class="line">    velocity =  <span class="keyword">new</span> PVector(random(-<span class="number">1</span>, <span class="number">1</span>), random(-<span class="number">2</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="comment">// We start at 255 and count down for convenience</span></span><br><span class="line">    lifespan = <span class="number">255</span>; <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">    <span class="comment">// Lifespan decreases</span></span><br><span class="line">    lifespan -= <span class="number">2.0</span>; <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Since our life ranges from 255 to 0 we can use it for alpha</span></span><br><span class="line">    stroke(<span class="number">0</span>, lifespan); <span class="comment">//</span></span><br><span class="line">    fill(<span class="number">175</span>, lifespan); <span class="comment">//</span></span><br><span class="line">    ellipse(location.x, location.y, <span class="number">8</span>, <span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询函数</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isDead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Is the particle still alive?</span></span><br><span class="line">    <span class="keyword">if</span> (lifespan &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    update();</span><br><span class="line">    display();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>现在我们有了一个描述单个粒子的类，我们已经准备好迈出下一步了。 当我们无法确定在任何给定时间我们可能拥有多少粒子时，我们如何跟踪许多粒子？</p>
<h2 id="动态数组"><a href="#动态数组" class="headerlink" title="动态数组"></a>动态数组</h2><h3 id="动态数组-1"><a href="#动态数组-1" class="headerlink" title="动态数组"></a>动态数组</h3><p>​    实际上，可以使用数组(Array)来管理粒子系统中的多个粒子对象。对于粒子数量固定的粒子系统来说，使用数组是非常有效的方法。Processing同时也提供了，expand()、contract()、subset()、splice()函数来调整数组大小。但是，这章中将会使用Java自带类ArrayList(<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/6/docs/api/java/util/ArrayList.html">ArrayList (Java Platform SE 6) (oracle.com)</a>)来代替Array管理粒子。</p>
<p>使用ArrayList和使用Array存储粒子对象的思想是一样的，只是语法不同。</p>
<p>如下代码分别使用ArrayList和Array实现的效果是一致的；</p>
<p><strong>数组方法实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> total = <span class="number">10</span>;</span><br><span class="line">Particle[] parray = <span class="keyword">new</span> Particle[total];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parray.length; i++) &#123;</span><br><span class="line">    parray[i] = <span class="keyword">new</span> Particle();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parray.length; i++) &#123;</span><br><span class="line">    Particle p = parray[i];</span><br><span class="line">    p.run();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ArrayList实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> total = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Particle&gt; plist = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; total; i++) &#123;</span><br><span class="line">    <span class="comment">// An object is added to an ArrayList with add().</span></span><br><span class="line">    plist.add(<span class="keyword">new</span> Particle());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// The size of the ArrayList is returned by size().</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; plist.size(); i++) &#123;</span><br><span class="line">    <span class="comment">// An object is accessed from the ArrayList with get(). </span></span><br><span class="line">    Particle p = plist.get(i);</span><br><span class="line">    p.run();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ArrayList中的加强for循环，’:’操作符。</p>
<h3 id="加强for循环操作符’-’"><a href="#加强for循环操作符’-’" class="headerlink" title="加强for循环操作符’:’"></a>加强for循环操作符’:’</h3><p>对于ArrayList\<Particle> 类可以使用’:’操作符号替换for，使得for迭代更加优雅、简洁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标准for循环</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;plist.size();i--)</span><br><span class="line">&#123;</span><br><span class="line">    Particle p=plist.get(i);</span><br><span class="line">    p.run();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ‘:’操作符号</span></span><br><span class="line"><span class="keyword">for</span> (Particle p : plist)</span><br><span class="line">&#123;</span><br><span class="line">    p.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="动态调整数组大小"><a href="#动态调整数组大小" class="headerlink" title="动态调整数组大小"></a>动态调整数组大小</h3><p>​    要求：在粒子系统中，实现每个draw循环周期新增一个粒子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Particle&gt; particles;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line">  <span class="comment">// A new Particle object is added to the ArrayList every cycle through draw().</span></span><br><span class="line">  particles.add(<span class="keyword">new</span> Particle(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; particles.size(); i++) &#123;</span><br><span class="line">    Particle p = particles.get(i);</span><br><span class="line">    p.run();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码能够满足要求，但是如果持续运行一段时间，会因为内存消耗过大导致程序崩溃，因为每个draw循环周期向着ArrayList中持续添加元素，ArrayList的大小会不断增大。</p>
<p>对应上述问题，通常我们会想到的方法是，减小ArrayList的元素个数，然后出现如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; particles.size(); i++) &#123;</span><br><span class="line">  Particle p = particles.get(i);</span><br><span class="line">  p.run();</span><br><span class="line">  <span class="comment">//If the particle is “dead,” we can go ahead and delete it from the list.</span></span><br><span class="line">  <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">    particles.remove(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码尽管能够消除ArrayList中元素过多，导致内存占用过大的问题，但是它存在一个很不容易发现的隐患。</p>
<p>通过堆栈的方式来对上面代码进行分析，ArrayList在增加和删除元素的过程中，应该是这样一个过程，</p>
<p><img src="https://natureofcode.com/book/imgs/chapter04/ch04_01.png"></p>
<p>for循环中，通过指针i的变化，索引到不同的元素：</p>
<ol>
<li>i=0 :arrow_right: 检查粒子A是否消失 :arrow_right: 保留粒子A</li>
<li>i=1:arrow_right: 检查粒子B是否消失 :arrow_right: 保留粒子B</li>
<li>i=2 :arrow_right: 检查粒子C是否消失 :arrow_right: 删除粒子C</li>
<li>(系统自动)将粒子D和粒子E移动到原来粒子C和粒子E所占的内存地址。</li>
</ol>
<p>但是在实现的过程中，由于删除完C时候，i=2，但是D又移动到原来C的位置上，所以这种简单的for循环实现方式并不能对D进行检查，存在漏检问题。针对上面一种情况，有两种解决方法：一种向后(backwards)迭代(iterate)ArrayList、另外一种是使用Jave提供的一种特殊类Iterator。</p>
<p><strong>Iterator</strong> 能够实现：</p>
<ul>
<li>给出下一个元素；</li>
<li>保证迭代过程中，即使出现移除元素也不会出现元素漏掉或二次出现；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Particle&gt; particles;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>, <span class="number">360</span>);</span><br><span class="line">  particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">  particles.add(<span class="keyword">new</span> Particle(<span class="keyword">new</span> PVector(width/<span class="number">2</span>, <span class="number">50</span>)));</span><br><span class="line"></span><br><span class="line">  Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">  <span class="comment">//Using an Iterator object instead of counting with int i</span></span><br><span class="line">  <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">    Particle p = it.next();</span><br><span class="line">    p.run();</span><br><span class="line">    <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">      it.remove();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="粒子系统类-The-Particle-System-Class"><a href="#粒子系统类-The-Particle-System-Class" class="headerlink" title="粒子系统类(The Particle System Class)"></a>粒子系统类(The Particle System Class)</h2><p>​    前面的章节已经实现了单个粒子类、使用ArrayList来管理多个粒子对象。现在需要实现一个ParticleSystem类，用来描述粒子系统本身的行为和属性。对粒子系统抽象成一个类，能够避免在<em>main</em>标签中冗杂的for循环，以及允许一个<em>main</em>标签中定义多个粒子系统。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSysSelf</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  ArrayList&lt;Particle&gt; particles;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// constructor</span></span><br><span class="line">  ParticleSysSelf()</span><br><span class="line">  &#123;</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// +</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// operator</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">    &#123;</span><br><span class="line">      Particle p = it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead())</span><br><span class="line">      &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>⏳ 2022-05-27 16:11</p>
<h2 id="系统的系统"><a href="#系统的系统" class="headerlink" title="系统的系统"></a>系统的系统</h2><p>系统是由一部分基本元素构成的，多个粒子(Particle)对象组成粒子系统(system of particle)，一个粒子系统就是多个粒子对象的集合。当然，粒子系统也可以看作是一个组成更大系统的元素，多个粒子系统的集合就叫粒子系统的系统(system of particle system)。</p>
<h2 id="继承和多态性：介绍"><a href="#继承和多态性：介绍" class="headerlink" title="继承和多态性：介绍"></a>继承和多态性：介绍</h2><p>面向对象(object-oriented )编程理论三个基本要素：继承(Inheritance )、多态(Polymorphism)、封装(encapsulation)；</p>
<p>考虑如下的情景，使用processing给你的朋友做一个生日贺卡，生日贺卡是由不同的彩色碎纸组成，这些碎纸有不同的颜色、形状、动作等属性。你可能会想到的解决方案是，先分别实现不同的碎纸类，然后再将这些类组成碎纸系统；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义不同类型的碎纸类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HappyConfetti</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunConfetti</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WackyConfetti</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来实现一个彩色碎纸系统，碎纸系统构造函数中引用不同的碎纸类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  ParticleSystem(<span class="keyword">int</span> num) &#123;</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">      <span class="keyword">float</span> r = random(<span class="number">1</span>);</span><br><span class="line">Randomly picking a <span class="string">&quot;kind&quot;</span> of particle</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span>      (r &lt; <span class="number">0.33</span>) &#123; particles.add(<span class="keyword">new</span> HappyConfetti()); &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (r &lt; <span class="number">0.67</span>) &#123; particles.add(<span class="keyword">new</span> FunConfetti());   &#125;</span><br><span class="line">      <span class="keyword">else</span>               &#123; particles.add(<span class="keyword">new</span> WackyConfetti()); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>上述能够实现想要的功能，但是存在两个问题：</p>
<ol>
<li>实现过程中，会拷贝\粘贴许多重复的代码；</li>
<li>ArrayList不会知道具体是新增的哪个类；</li>
</ol>
<p>要解决问题2可以通过申明不同的类型ArrayList来实现，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;HappyConfetti&gt; a1 = <span class="keyword">new</span> ArrayList&lt;HappyConfetti&gt;();</span><br><span class="line">ArrayList&lt;FunConfetti&gt;   a2 = <span class="keyword">new</span> ArrayList&lt;FunConfetti&gt;();</span><br><span class="line">ArrayList&lt;WackyConfetti&gt; a3 = <span class="keyword">new</span> ArrayList&lt;WackyConfetti&gt;();</span><br></pre></td></tr></table></figure>
<p>这似乎非常不方便，因为我们真的只想要一个列表来跟踪粒子系统中的所有内容。 这可以通过多态性来实现。多态性将允许我们将不同类型的对象视为相同类型并将它们存储在单个 ArrayList 中。</p>
<h2 id="继承基础"><a href="#继承基础" class="headerlink" title="继承基础"></a>继承基础</h2><p>让我们举一个不同的例子，动物世界：狗、猫、猴子、熊猫、袋熊和海荨麻。 我们将从编写 Dog 类开始。 Dog 对象将有一个年龄变量（一个整数），以及 eat()、sleep() 和 bark() 函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    Dog()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// constructor</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// eat</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// sleep</span></span><br><span class="line">    &#125;;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// bark</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们实现一个Cat类，该类同样具有Dog类一样的属性和函数，那么代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    Cat()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// constructor</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// eat</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// sleep</span></span><br><span class="line">    &#125;;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">meow</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// bark</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们为鱼、马、考拉和狐猴重写相同的代码时，这个过程将变得相当乏味。 相反，让我们开发一个可以描述任何类型动物的通用 Animal 类。 毕竟，所有的动物都吃和睡。 那么我们可以说：</p>
<ul>
<li>狗是动物，具有动物的所有特性，可以做动物做的所有事情。 此外，狗会吠叫。</li>
<li>猫是动物，具有动物的所有特性，可以做动物做的所有事情。 此外，猫会喵喵叫。</li>
</ul>
<p>继承使这一切成为可能。 通过继承，类可以从其他类继承属性（变量）和功能（方法）。 Dog 类是 Animal 类的子类。 子类会自动继承父类（超类）的所有变量和函数，但也可以包含父类中没有的函数和变量。 就像“生命之树”一样，遗传遵循树形结构。 狗从犬科继承，从哺乳动物继承，从动物继承，等等。</p>
<p><img src="https://natureofcode.com/book/imgs/chapter04/ch04_02.png"></p>
<p>使用继承的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The Animal class is the parent (or super) class.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Dog and Cat inherit the variable age.</span></span><br><span class="line">  <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">  Animal() &#123;</span><br><span class="line">    age = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//[full] Dog and Cat inherit the functions eat() and sleep().</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;Yum!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;Zzzzzz&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The Dog class is the child (or sub) class, indicated by the code &quot;extends Animal&quot;.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123; <span class="comment">//[bold]</span></span><br><span class="line">  Dog() &#123;</span><br><span class="line">    <span class="comment">// super() executes code found in the parent class.</span></span><br><span class="line">    <span class="keyword">super</span>(); <span class="comment">//[bold]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// We define bark() in the child class, since it isn&#x27;t part of the parent class.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  Cat() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">meow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;MEOW!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继承引入的两个新术语：</p>
<ul>
<li><code>extends</code> 关键字用于表明正在定义的类的父级。 类只能扩展一个类。 但是，类可以扩展其他类的类，即 Dog 扩展 Animal，Terrier 扩展 Dog。 </li>
<li><code>super()</code> - 这会调用父类中的构造函数。 换句话说，无论你在父构造函数中做什么，在子构造函数中也一样。 除了 super() 之外，还可以将其他代码写入构造函数。 如果父构造函数定义了匹配的参数，super() 也可以接收参数。</li>
</ul>
<p>子类中可以定义父类中不具有的属性和功能。例如，假设Dog类的对象除了age外还有haircolor属性，并且其是随机的，那么代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">// A child class can introduce new variables not</span></span><br><span class="line">  <span class="comment">// included in the parent.</span></span><br><span class="line">  color haircolor;</span><br><span class="line">  Dog() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    haircolor = color(random(<span class="number">255</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意父类构造函数是如何通过 super() 调用的，它将年龄设置为 0，但是头发颜色是在 Dog类构造函数本身设置的。 如果 Dog 对象与一般 Animal 对象的eat方法不同，则可以通过重写(overwirte)子类中的函数来覆盖父函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  color haircolor;</span><br><span class="line"></span><br><span class="line">  Dog() &#123;</span><br><span class="line">     <span class="keyword">super</span>();</span><br><span class="line">     haircolor = color(random(<span class="number">255</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A child can override a parent function if necessary.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// A Dog&#x27;s specific eating characteristics</span></span><br><span class="line">    println(<span class="string">&quot;Woof! Woof! Slurp.&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，如果Dog类的eat方法和Animal一样，只是有一些额外的功能，子类既可以运行父类的代码，也可以合并自定义代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">   color haircolor;</span><br><span class="line"></span><br><span class="line">   Dog() &#123;</span><br><span class="line">     <span class="keyword">super</span>();</span><br><span class="line">     haircolor = color(random(<span class="number">255</span>));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">// Call eat() from Animal.</span></span><br><span class="line">     <span class="comment">// A child can execute a function from the parent</span></span><br><span class="line">     <span class="comment">// while adding its own code.</span></span><br><span class="line">     <span class="keyword">super</span>.eat(); <span class="comment">//[bold]</span></span><br><span class="line">     <span class="comment">// Add some additional code</span></span><br><span class="line">     <span class="comment">// for a Dog&#x27;s specific eating characteristics.</span></span><br><span class="line">     println(<span class="string">&quot;Woof!!!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="具有继承性的粒子"><a href="#具有继承性的粒子" class="headerlink" title="具有继承性的粒子"></a>具有继承性的粒子</h2><p>现在我们已经介绍了继承的理论及其语法，我们可以基于已有的Particle 类在 Processing 中开发一个工作示例。</p>
<p>一个简单的粒子类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.05</span>);</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector(random(-<span class="number">1</span>,<span class="number">1</span>),random(-<span class="number">2</span>,<span class="number">0</span>));</span><br><span class="line">    location = l.get();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    update();</span><br><span class="line">    display();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fill(<span class="number">0</span>);</span><br><span class="line">    ellipse(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，我们从 Particle 创建一个子类（我们称之为 Confetti）。 它将从 Particle 继承所有实例变量和方法。 我们编写了一个名为 Confetti 的新构造函数，并通过调用 super() 从父类执行代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Confetti</span> <span class="keyword">extends</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We could add variables for only Confetti here.</span></span><br><span class="line"></span><br><span class="line">  Confetti(PVector l) &#123;</span><br><span class="line">    <span class="keyword">super</span>(l);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// There is no code here because we inherit update() from parent.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//[full] Override the display method.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    rectMode(CENTER);</span><br><span class="line">    fill(<span class="number">175</span>);</span><br><span class="line">    stroke(<span class="number">0</span>);</span><br><span class="line">    rect(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然可以让Confetti类的形式更加复杂，比如让其能够按照一定规律旋转，那么覆写display函数既可以实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">float</span> theta = map(location.x,<span class="number">0</span>,width,<span class="number">0</span>,TWO_PI*<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  rectMode(CENTER);</span><br><span class="line">  fill(<span class="number">0</span>,lifespan);</span><br><span class="line">  stroke(<span class="number">0</span>,lifespan);</span><br><span class="line">	</span><br><span class="line">  pushMatrix();</span><br><span class="line">  translate(location.x,location.y);</span><br><span class="line">  rotate(theta);</span><br><span class="line">  rect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  popMatrix();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们有了一个扩展基本粒子类的 Confetti 类，我们需要弄清楚ParticleSystem 类如何在同一系统中管理不同类型的粒子。 为了实现这个目标，让我们回到动物界继承的例子，看看这个概念是如何延伸到多态世界的。</p>
<h2 id="多态基础"><a href="#多态基础" class="headerlink" title="多态基础"></a>多态基础</h2><p>将 一个Dog 对象视为 Dog 类或 Animal 类（其父类）的成员的能力是多态性的一个示例。 <strong>多态性（来自希腊语 polymorphos，意为多种形式）是指以多种形式处理对象的单个实例。</strong> 狗当然是狗，但由于 Dog类继承自 Animal类，它也可以被认为是动物。 在代码中，我们可以两种方式引用它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Dog rover = <span class="keyword">new</span> Dog();</span><br><span class="line">Animal spot = <span class="keyword">new</span> Dog();</span><br></pre></td></tr></table></figure>
<p>尽管第二行代码最初似乎违反了语法规则，但声明 Dog 对象的两种方式都是合法的。 即使我们将 spot 声明为 Animal 对象，我们实际上是在创建 Dog 对象并将其存储在 spot 变量中。 我们可以安全地调用所有 Animal 类方法，因为继承规则规定狗可以做任何动物可以做的事情。  但是，如果 Dog 类覆盖 Animal 类中的 eat() 函数怎么办？ 即使将spot 声明为Animal，Java 也会确定它的真实身份是Dog 并运行适当版本的eat() 函数。 当我们有一个数组或 ArrayList 时，这特别有用。</p>
<h2 id="具有多态性的粒子系统"><a href="#具有多态性的粒子系统" class="headerlink" title="具有多态性的粒子系统"></a>具有多态性的粒子系统</h2><p>让我们暂时假设不存在多态性并重写一个 ParticleSystem 类以包含许多 Particle 对象和许多 Confetti 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">  ArrayList&lt;Particle&gt; particles; <span class="comment">//[bold]</span></span><br><span class="line">  ArrayList&lt;Confetti&gt; confetti; <span class="comment">//[bold]</span></span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;(); <span class="comment">//[bold]</span></span><br><span class="line">    confetti = <span class="keyword">new</span> ArrayList&lt;Confetti&gt;(); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle(origin)); <span class="comment">//[bold]</span></span><br><span class="line">    particles.add(<span class="keyword">new</span> Confetti(origin)); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator(); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Particle p = it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    it = confetti.iterator(); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Confetti c = it.next();</span><br><span class="line">      c.run();</span><br><span class="line">      <span class="keyword">if</span> (c.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意我们有两个单独的列表，一个用于particle，一个用于confetti。 我们想要执行的每个动作都必须执行两次！ 多态性允许我们通过只创建一个包含标准粒子对象和五彩纸屑对象的粒子 ArrayList 来简化上述操作。 我们不必担心哪个是哪个； 这一切都会为我们解决！ （另外，请注意主程序和类的代码并没有改变，所以我们没有在这里包含它。请参阅网站以获取完整示例。）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  <span class="comment">// One list, for anything that is a Particle</span></span><br><span class="line">  <span class="comment">// or extends Particle</span></span><br><span class="line">  ArrayList&lt;Particle&gt; particles;  <span class="comment">//[bold]</span></span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> r = random(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// We have a 50% chance of adding each kind of Particle.</span></span><br><span class="line">    <span class="keyword">if</span> (r &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">      particles.add(<span class="keyword">new</span> Particle(origin));  <span class="comment">//[bold]</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      particles.add(<span class="keyword">new</span> Confetti(origin));  <span class="comment">//[bold]</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      <span class="comment">// Polymorphism allows us to treat everything as a</span></span><br><span class="line">      <span class="comment">// Particle, whether it is a Particle or a Confetti.</span></span><br><span class="line">      Particle p = it.next(); <span class="comment">//[bold]</span></span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="具有力的粒子系统"><a href="#具有力的粒子系统" class="headerlink" title="具有力的粒子系统"></a>具有力的粒子系统</h2><p>到目前为止，在本章中，我们一直专注于以面向对象的思想来构建代码。 也许您注意到了，或者您没有注意到，但是在此过程中，我们不知不觉地从前章中的位置往后几步（这里指的是对粒子运动复杂性）。 让我们检查一下简单粒子类的构造函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Particle(PVector l) &#123;</span><br><span class="line">  <span class="comment">// We’re setting acceleration to a constant value!</span></span><br><span class="line">  acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.05</span>); <span class="comment">//[bold]</span></span><br><span class="line"></span><br><span class="line">  velocity = <span class="keyword">new</span> PVector(random(-<span class="number">1</span>,<span class="number">1</span>),random(-<span class="number">2</span>,<span class="number">0</span>));</span><br><span class="line">  location = l.get();</span><br><span class="line">  lifespan = <span class="number">255.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>update()</em>函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector force)</span> </span>&#123;</span><br><span class="line">  PVector f = force.get();</span><br><span class="line">  f.div(mass);</span><br><span class="line">  acceleration.add(f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了上述代码，可以在<em>update()</em>函数中添加一行代码来清除加速度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  velocity.add(acceleration);</span><br><span class="line">  location.add(velocity);</span><br><span class="line">  <span class="comment">// There it is!</span></span><br><span class="line">  acceleration.mult(<span class="number">0</span>);</span><br><span class="line">  lifespan -= <span class="number">2.0</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>添加加速度属性的粒子系统完整代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="keyword">float</span> lifespan;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We could vary mass for more interesting results.</span></span><br><span class="line">  <span class="keyword">float</span> mass = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    <span class="comment">// We now start with acceleration of 0.</span></span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector(random(-<span class="number">1</span>,<span class="number">1</span>),random(-<span class="number">2</span>,<span class="number">0</span>));</span><br><span class="line">    location = l.get();</span><br><span class="line">    lifespan = <span class="number">255.0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    update();</span><br><span class="line">    display();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Newton’s second law &amp; force accumulation</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector force)</span> </span>&#123;</span><br><span class="line">    PVector f = force.get();</span><br><span class="line">    f.div(mass);</span><br><span class="line">    acceleration.add(f);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Standard update</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">    acceleration.mult(<span class="number">0</span>);</span><br><span class="line">    lifespan -= <span class="number">2.0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Our Particle is a circle.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">255</span>,lifespan);</span><br><span class="line">    fill(<span class="number">255</span>,lifespan);</span><br><span class="line">    ellipse(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Should the Particle be deleted?</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isDead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lifespan &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，粒子类已经完成，我们有一个非常重要的问题要问。 在哪里调用<em>applyforce()</em>函数更为好？ 在粒子类update()代码中，将力施加到粒子上是否合适？ 事实是没有正确或错误的答案； 这实际上取决于特定处理草图的确切功能和目标。 尽管如此，我们仍可以提出一种可能适用于大多数情况的通用解决方案，并制定一个模型，以将力施加到系统中的单个粒子。 </p>
<p>让我们考虑以下任务：每次通过<em>draw()</em>函数施加一个全局的力到每个粒子上。 使用一个指定下的重力来举例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>);</span><br></pre></td></tr></table></figure>
<p>完整代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">ParticleSystem ps;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Apply a force to all particles.</span></span><br><span class="line">  PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>); </span><br><span class="line">  ps.applyForce(gravity); </span><br><span class="line"></span><br><span class="line">  ps.addParticle();</span><br><span class="line">  ps.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  ArrayList&lt;Particle&gt; particles;</span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle(origin));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector f)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Using an enhanced loop to apply the force to all particles</span></span><br><span class="line">    <span class="keyword">for</span> (Particle p: particles) &#123;</span><br><span class="line">      p.applyForce(f);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  Can’t use the enhanced loop because we want to check for particles to delete.</span></span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Particle p = (Particle) it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="带排斥器的粒子系统"><a href="#带排斥器的粒子系统" class="headerlink" title="带排斥器的粒子系统"></a>带排斥器的粒子系统</h2><p>如果我们想让给这个例子进一步添加一个排斥器(Repeller)对象——第二章中介绍的吸引子(Attractor)的反面，该怎么办？这需要更复杂一点，因为与重力不同，吸引子或排斥器施加在粒子上的每个力都必须针对每个粒子进行计算。</p>
<table><tr>
<td><img src=https://natureofcode.com/book/imgs/chapter04/ch04_03.png border=0></td>
<td><img src=https://natureofcode.com/book/imgs/chapter04/ch04_04.png border=0></td>
</tr></table>

<p>让我们通过检查如何将新的 Repeller 对象合并到对简单粒子系统施力的示例中来开始解决这个问题。 需要在代码中添加两个主要内容：</p>
<ol>
<li>一个 Repeller 对象（声明、初始化和显示）。</li>
<li>将 Repeller 对象传递到 ParticleSystem 的函数，以便它可以对每个粒子对象施加力。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ParticleSystem ps;</span><br><span class="line"><span class="comment">// New thing: we declare a Repeller object.</span></span><br><span class="line">Repeller repeller; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>));</span><br><span class="line">  <span class="comment">//  initialize a Repeller object.</span></span><br><span class="line">  repeller = <span class="keyword">new</span> Repeller(width/<span class="number">2</span>-<span class="number">20</span>,height/<span class="number">2</span>); <span class="comment">//[bold]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">100</span>);</span><br><span class="line">  ps.addParticle();</span><br><span class="line"></span><br><span class="line">  PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">  <span class="comment">// apply gravity to every particle in  system of particle</span></span><br><span class="line">  ps.applyForce(gravity);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// New thing: apply a force from a repeller.</span></span><br><span class="line">  ps.applyRepeller(repeller); <span class="comment">//[bold]</span></span><br><span class="line"></span><br><span class="line">  ps.run();</span><br><span class="line">  <span class="comment">//  we display the Repeller object.</span></span><br><span class="line">  repeller.display();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Repeller类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeller</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  <span class="keyword">float</span> r = <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line">  Repeller(<span class="keyword">float</span> x, <span class="keyword">float</span> y)  &#123;</span><br><span class="line">    location = <span class="keyword">new</span> PVector(x,y);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">255</span>);</span><br><span class="line">    fill(<span class="number">255</span>);</span><br><span class="line">    ellipse(location.x,location.y,r*<span class="number">2</span>,r*<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更难的问题是，在粒子系统类中如何编写 applyRepeller() 函数？ 与将 PVector 传递给函数的applyForce() 不同， applyRepeller()需要将 Repeller 对象传递到函数中，并在函数中完成计算 repeller 和所有粒子之间的力。首先来看一下两个函数各自需要具有的功能：</p>
<table class="code">
<tbody><tr>
<th>applyForce()</th>
<th>applyRepeller</th>
</tr>
<tr>
<td>
<pre>void applyForce(PVector f) {
  for (Particle p: particles) {
    p.applyForce(f);
  }
}
</pre>
</td>
<td>
<pre>void applyRepeller(Repeller r) {
  for (Particle p: particles) {
    PVector force = r.repel(p);
    p.applyForce(force);
  }
}
</pre>
</td>
</tr>
</tbody></table>

<p>功能几乎相同。 只有两个区别。 </p>
<ol>
<li>函数的参数不同，一个是Repeller对象，一个是PVector对象。</li>
<li>必须为每个粒子单独计算力(PVector)并将其作用到粒子上。</li>
</ol>
<p>这个力是如何计算的？在repel() 的函数中，它是我们为 Attractor 类编写的吸引函数的反函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">PVector <span class="title">repel</span><span class="params">(Particle p)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1) Get force direction.</span></span><br><span class="line">    PVector dir =</span><br><span class="line">        PVector.sub(location,p.location);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2) Get distance (constrain distance).</span></span><br><span class="line">    <span class="keyword">float</span> d = dir.mag();</span><br><span class="line">    d = constrain(d,<span class="number">5</span>,<span class="number">100</span>);</span><br><span class="line">  </span><br><span class="line">    dir.normalize();</span><br><span class="line">    <span class="comment">// 3) Calculate magnitude.</span></span><br><span class="line">    <span class="keyword">float</span> force = -<span class="number">1</span> * G / (d * d);</span><br><span class="line">    <span class="comment">// 4) Make a vector out of direction and magnitude.</span></span><br><span class="line">    dir.mult(force);</span><br><span class="line">    <span class="keyword">return</span> dir;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述添加排斥器的整个过程中，我们从未考虑过改变Particle类本身。 粒子实际上并不需要知道任何关于其类细节的信息。 它只需要管理它的位置、速度和加速度，并具有接收外力并对其施加作用的能力。 因此，我们现在可以完整地查看这个示例，再次省略没有更改的 Particle 类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// One ParticleSystem</span></span><br><span class="line">ParticleSystem ps;</span><br><span class="line"><span class="comment">// One repeller</span></span><br><span class="line">Repeller repeller;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>));</span><br><span class="line">  repeller = <span class="keyword">new</span> Repeller(width/<span class="number">2</span>-<span class="number">20</span>,height/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">100</span>);</span><br><span class="line">  ps.addParticle();</span><br><span class="line">  <span class="comment">// We’re applying a universal gravity.</span></span><br><span class="line">  PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">  ps.applyForce(gravity);</span><br><span class="line">  <span class="comment">// Applying the repeller</span></span><br><span class="line">  ps.applyRepeller(repeller);</span><br><span class="line"></span><br><span class="line">  ps.run();</span><br><span class="line">  repeller.display();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The ParticleSystem manages all the Particles.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  ArrayList&lt;Particle&gt; particles;</span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle(origin));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Applying a force as a PVector</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Particle p: particles) &#123;</span><br><span class="line">      p.applyForce(f);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyRepeller</span><span class="params">(Repeller r)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Calculating a force for each Particle based on a Repeller</span></span><br><span class="line">    <span class="keyword">for</span> (Particle p: particles) &#123;</span><br><span class="line">      PVector force = r.repel(p);</span><br><span class="line">      p.applyForce(force);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Particle p = (Particle) it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// How strong is the repeller?</span></span><br><span class="line">  <span class="keyword">float</span> strength = <span class="number">100</span>;</span><br><span class="line">  PVector location;</span><br><span class="line">  <span class="keyword">float</span> r = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Repeller(<span class="keyword">float</span> x, <span class="keyword">float</span> y)  &#123;</span><br><span class="line">    location = <span class="keyword">new</span> PVector(x,y);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">255</span>);</span><br><span class="line">    fill(<span class="number">255</span>);</span><br><span class="line">    ellipse(location.x,location.y,r*<span class="number">2</span>,r*<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">PVector <span class="title">repel</span><span class="params">(Particle p)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// This is the same repel algorithm we used in Chapter 2: forces based on gravitational attraction.</span></span><br><span class="line">    PVector dir = PVector.sub(location,p.location);</span><br><span class="line">    <span class="keyword">float</span> d = dir.mag();</span><br><span class="line">    dir.normalize();</span><br><span class="line">    d = constrain(d,<span class="number">5</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">float</span> force = -<span class="number">1</span> * strength / (d * d);</span><br><span class="line">    dir.mult(force);</span><br><span class="line">    <span class="keyword">return</span> dir;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="图像纹理和加性混合"><a href="#图像纹理和加性混合" class="headerlink" title="图像纹理和加性混合"></a>图像纹理和加性混合</h2><p>尽管这本书实际上是关于行为和算法而不是计算机图形和设计，但我认为如果我们讨论粒子系统并且从未看过涉及每个纹理的示例，我们将无法忍受自己带有图像的粒子。 就设计某些类型的视觉效果而言，选择绘制粒子的方式是难题的重要组成部分。</p>
<p>这两个图像都是由相同的算法生成的。 唯一的区别是在图像 A 中为每个粒子绘制了一个白色圆圈，而在 B 中为每个粒子绘制了一个“模糊”斑点。</p>
<p><img src="https://natureofcode.com/book/imgs/chapter04/ch04_05.png"></p>
<p>在你编写任何代码之前，需要先制作图像纹理！建议使用 PNG 格式，因为在绘制图像时将保留 alpha 通道（即透明度），这是将纹理混合为相互叠加的粒子层所必需的。</p>
<hr>
<p>By W.h. 2022-06-15 11:28:39</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://yoursite-url/undefined/TheNatureOfCode-ParticleSystem/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="../Target/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            Target
          
        </div>
      </a>
    
    
      <a href="../%E5%A3%AB%E5%85%B5%E7%AA%81%E5%87%BB%E2%80%94%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%85%B5%E7%8E%8B%E7%9A%84%E6%95%85%E4%BA%8B/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">士兵突击—不是一个兵王的故事</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2023
        <i class="ri-heart-fill heart_icon"></i> Wh
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="../../index.html"><img src="/img/avatar/favicon-32x32-monkey.png" alt="Wh&#39;s 🛰️ Blogs"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="../../index.html">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="../../archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="../../categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="../../tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="../../about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="../../images/wechat.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="../../images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="../../js/jquery-3.6.0.min.js"></script>
 
<script src="../../js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="../../js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="../../dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.staticfile.org/mathjax/2.7.7/MathJax.js"></script>
<script src="https://cdn.staticfile.org/mathjax/2.7.7/config/TeX-AMS-MML_HTMLorMML-full.js"></script>
<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="../../js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="../../css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>