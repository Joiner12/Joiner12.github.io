<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="脑海中起毛球的记忆" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Wh&#39;s 🛰️ Blogs</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/img/avatar/Jr.Png" />
       
<link rel="stylesheet" href="dist/main.css">

      
<link rel="stylesheet" href="css/fonts/remixicon.css">

      
<link rel="stylesheet" href="css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Joiner12"
        target="_blank"><img width="149" height="149" src="images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/img/header_img/newhome_bg-1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="index.html">Wh&#39;s 🛰️ Blogs</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['没有记录 就没有发生', '保持身心健康', '吃药不一定能治病 学习一定能治蠢'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  <ul class="ads">
    
        <li>
            <a href="">
                <img src="" width="10" alt="">
            </a>
        </li>
    
        <li>
            <a href="">
                <img src="" width="10" alt="">
            </a>
        </li>
    
</ul>
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Target"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/Target/"
    >Target</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/Target/" class="article-date">
  <time datetime="2022-05-30T02:36:53.000Z" itemprop="datePublished">2022-05-30</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><strong>人需要给自己定一些可行度高的目标来敦促自己不浪费生命！</strong></p>
<p>淡泊明志，宁静致远。</p>
<hr>
<h2 id="2022-05-25"><a href="#2022-05-25" class="headerlink" title="2022-05-25"></a>2022-05-25</h2><blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://natureofcode.com/book/">The Nature of Code</a> 学习翻译一章  </li>
<li>《全球化与国家竞争：新兴七国比较研究》</li>
</ol>
</blockquote>
<h2 id="2022-05-31"><a href="#2022-05-31" class="headerlink" title="2022-05-31"></a>2022-05-31</h2><ol>
<li>不妨考虑把烟戒掉！</li>
</ol>
<h2 id="2022-06-06"><a href="#2022-06-06" class="headerlink" title="2022-06-06"></a>2022-06-06</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">事项</th>
<th style="text-align:center">DeadLine</th>
<th style="text-align:center">耗时</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://natureofcode.com/book/">The Nature of Code</a> 粒子系统</td>
<td style="text-align:center">本周</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">《全球化与国家竞争：新兴七国比较研究》</td>
<td style="text-align:center">本周</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">40w+</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h2 id="2022-06-13"><a href="#2022-06-13" class="headerlink" title="2022-06-13"></a>2022-06-13</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">事项</th>
<th style="text-align:center">进度</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://natureofcode.com/book/">The Nature of Code</a> 向量</td>
<td style="text-align:center">■□□□□</td>
</tr>
<tr>
<td style="text-align:center">水浒传108</td>
<td style="text-align:center">0%</td>
</tr>
<tr>
<td style="text-align:center">拾音柱</td>
<td style="text-align:center">0%</td>
</tr>
</tbody>
</table>
</div>
<h2 id="2022-06-20"><a href="#2022-06-20" class="headerlink" title="2022-06-20"></a>2022-06-20</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">事项</th>
<th style="text-align:center">进度</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://natureofcode.com/book/">The Nature of Code</a> instruction</td>
<td style="text-align:center">■■■■■</td>
</tr>
<tr>
<td style="text-align:center">拾音柱</td>
<td style="text-align:center">■□□□□</td>
</tr>
<tr>
<td style="text-align:center">LM算法</td>
<td style="text-align:center">□□□□□</td>
</tr>
<tr>
<td style="text-align:center">龙格库塔积分</td>
<td style="text-align:center">■■■■■</td>
</tr>
</tbody>
</table>
</div>
<h2 id="2022-07-04"><a href="#2022-07-04" class="headerlink" title="2022-07-04"></a>2022-07-04</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">事项</th>
<th style="text-align:center">进度</th>
<th style="text-align:center">预估时长</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://natureofcode.com/book/">The Nature of Code</a> vector</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">10h</td>
</tr>
<tr>
<td style="text-align:center">水浒传108</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">10h</td>
</tr>
<tr>
<td style="text-align:center">拾音柱</td>
<td style="text-align:center">■□□□□</td>
<td style="text-align:center">∞</td>
</tr>
<tr>
<td style="text-align:center">LM算法</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">ds</td>
</tr>
<tr>
<td style="text-align:center">龙格库塔积分-文档</td>
<td style="text-align:center">■■■■□</td>
<td style="text-align:center">4h</td>
</tr>
<tr>
<td style="text-align:center">随机误差分析(Allan方差)-文档</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">10h</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="2022-07-18"><a href="#2022-07-18" class="headerlink" title="2022-07-18"></a>2022-07-18</h2><p>专注是效率的保障；</p>
<p>修为；</p>
<p>百善孝为先，论心不论迹<strong>，</strong>论迹贫家无孝子；万恶淫为首，论迹不论心，论心世上无完人。</p>
<hr>
<h2 id="2022-07-25"><a href="#2022-07-25" class="headerlink" title="2022-07-25"></a>2022-07-25</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">事项</th>
<th style="text-align:center">进度</th>
<th style="text-align:center">预估时长</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://natureofcode.com/book/">The Nature of Code</a> vector</td>
<td style="text-align:center">■■□□□</td>
<td style="text-align:center">10h</td>
</tr>
<tr>
<td style="text-align:center">《动机与人格》</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">20h</td>
</tr>
<tr>
<td style="text-align:center">水浒传108</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">10h</td>
</tr>
<tr>
<td style="text-align:center">拾音柱</td>
<td style="text-align:center">■□□□□</td>
<td style="text-align:center">∞</td>
</tr>
<tr>
<td style="text-align:center">LM算法</td>
<td style="text-align:center">■■■□□</td>
<td style="text-align:center">ds</td>
</tr>
<tr>
<td style="text-align:center">龙格库塔积分-文档</td>
<td style="text-align:center">■■■■□</td>
<td style="text-align:center">4h</td>
</tr>
<tr>
<td style="text-align:center">随机误差分析(Allan方差)-文档</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">10h</td>
</tr>
<tr>
<td style="text-align:center">kalman filter</td>
<td style="text-align:center">□□□□□</td>
<td style="text-align:center">20h</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Idea</strong></p>
<ol>
<li>动态歌词 processing</li>
</ol>
<h2 id="2022-08-01"><a href="#2022-08-01" class="headerlink" title="2022-08-01"></a>2022-08-01</h2><p><strong>Idea</strong></p>
<ol>
<li>情感时间线</li>
<li>IMU - motor</li>
</ol>
<h2 id="2022-08-12"><a href="#2022-08-12" class="headerlink" title="2022-08-12"></a>2022-08-12</h2><ol>
<li>mahony filter .vs. 滑动均值滤波</li>
</ol>
<h2 id="2022-12-12"><a href="#2022-12-12" class="headerlink" title="2022-12-12"></a>2022-12-12</h2><ol>
<li>没有经过审视的人生不值得过</li>
</ol>
<p>--------------------------------------------------------------✂------------------------------------------------------------------  </p>

<h2 id="书单"><a href="#书单" class="headerlink" title="书单"></a>书单</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">事项</th>
<th style="text-align:center">进度</th>
<th style="text-align:center">TimeFrame</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/20424526/">邓小平时代 </a></td>
<td style="text-align:center">$100\%$</td>
<td style="text-align:center">2022/11/26 - 2022/12/29</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35546622/">置身事内：中国政府与经济发展</a></td>
<td style="text-align:center">$100\%$</td>
<td style="text-align:center">2022/11/26 - 2022/12/19</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35314182/">全球化与国家竞争 </a></td>
<td style="text-align:center">$100\%$</td>
<td style="text-align:center">None</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35660644/">动机与人格</a></td>
<td style="text-align:center">$100\%$</td>
<td style="text-align:center">None</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/27012024/">哲学简史</a></td>
<td style="text-align:center">$100\%$</td>
<td style="text-align:center">2022/10/1 - 2022/11/25</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/34996404/">苏东坡新传</a></td>
<td style="text-align:center">$5\%$</td>
<td style="text-align:center">2022/12/20 -</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1207500/">布局天下</a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/20434298/">抗日战争中阵亡的国民党将军</a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/25763679/">不确定世界的理性选择</a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35593780/">工作、消费主义和新穷人</a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/36092576/">摩托日记</a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26925171/">大明王朝1566</a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/22867024/">南怀瑾选集 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4820710/">1984 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/24257229/">鼠疫 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5288935/">我说参同契（上中下） </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/6857548/">宅经 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35871087/">逆向投资：邓普顿的长赢投资法 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/36104107/">长安的荔枝 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26803714/">人性的枷锁 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3320425/">跨越鸿沟 </a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-quaternion"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/quaternion/"
    >quaternion</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/quaternion/" class="article-date">
  <time datetime="2022-08-08T07:43:52.000Z" itemprop="datePublished">2022-08-08</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>四元数在三维旋转中的是最常用的一种方法，最近在做关于IMU相关的工作，下面就是过程中涉及到的相关资料的收集整理和个人理解记录。</p>
<img lazyload="" src="/images/loading.svg" data-src="quaternion-2.png">
<h1>四元数与三维旋转</h1>
<p><a class="link" target="_blank" rel="noopener" href="https://krasjet.github.io/quaternion/">Krasjet的文章<i class="fa-solid fa-up-right-from-square"></i></a>从二维复数开始，然后讨论用二维复数和二维空间中向量旋转的关系。然后引出四元数（Quaternion）及用四元数来表示三维空间中向量旋转相关知识。语言通俗、详细地推导了相关的数学公式，是很好的一篇文章，且在附录部分介绍了很多继续深入学习的资料。</p>
<center><embed src="quaternion.pdf" width="780" height="800"></center>
<h1>四元数与欧拉角</h1>
<p>欧拉角：</p>
<ul>
<li>Yaw(偏航)，<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.473ex" height="2.034ex" role="img" focusable="false" viewBox="0 -694 651 899"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D713" d="M161 441Q202 441 226 417T250 358Q250 338 218 252T187 127Q190 85 214 61Q235 43 257 37Q275 29 288 29H289L371 360Q455 691 456 692Q459 694 472 694Q492 694 492 687Q492 678 411 356Q329 28 329 27T335 26Q421 26 498 114T576 278Q576 302 568 319T550 343T532 361T524 384Q524 405 541 424T583 443Q602 443 618 425T634 366Q634 337 623 288T605 220Q573 125 492 57T329 -11H319L296 -104Q272 -198 272 -199Q270 -205 252 -205H239Q233 -199 233 -197Q233 -192 256 -102T279 -9Q272 -8 265 -8Q106 14 106 139Q106 174 139 264T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 299 34 333T82 404T161 441Z"></path></g></g></g></svg></mjx-container></li>
<li>Roll(横滚)，<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.348ex" height="2.034ex" role="img" focusable="false" viewBox="0 -694 596 899"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D719" d="M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z"></path></g></g></g></svg></mjx-container></li>
<li>Pitch(俯仰)，<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex;" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></li>
</ul>
<p>向量绕轴<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="35.732ex" height="2.47ex" role="img" focusable="false" viewBox="0 -841.7 15793.5 1091.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext" fill="red" stroke="red"><path data-c="5C" d="M56 731Q56 740 62 745T75 750Q85 750 92 740Q96 733 270 255T444 -231Q444 -239 438 -244T424 -250Q414 -250 407 -240Q404 -236 230 242T56 731Z"></path><path data-c="62" d="M307 -11Q234 -11 168 55L158 37Q156 34 153 28T147 17T143 10L138 1L118 0H98V298Q98 599 97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V543Q179 391 180 391L183 394Q186 397 192 401T207 411T228 421T254 431T286 439T323 442Q401 442 461 379T522 216Q522 115 458 52T307 -11ZM182 98Q182 97 187 90T196 79T206 67T218 55T233 44T250 35T271 29T295 26Q330 26 363 46T412 113Q424 148 424 212Q424 287 412 323Q385 405 300 405Q270 405 239 390T188 347L182 339V98Z" transform="translate(500,0)"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(1056,0)"></path><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(1556,0)"></path><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" transform="translate(1834,0)"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2390,0)"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(3118.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(4174.6,0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(4452.6,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(4981.6,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(5426.2,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(5855.2,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(6299.9,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="msup" transform="translate(6732.9,0)"><g data-mml-node="mo"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mi" transform="translate(311,363) scale(0.707)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g><g data-mml-node="mo" transform="translate(7591.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mo" transform="translate(8036.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msup" transform="translate(8425.4,0)"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mn" transform="translate(562,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(9613.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msup" transform="translate(10613.4,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mn" transform="translate(462,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(11701.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msup" transform="translate(12701.4,0)"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mn" transform="translate(466,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(13848.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(14904.5,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(15404.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container> 旋转<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.448ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 640 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path></g></g></g></svg></mjx-container> 角度的过程用四元数表示为：</p>
<p>$$<br>
\bold{q}(\alpha, \bold{r}) = [cos(\alpha/2)，a<em>sin(\alpha/2)，b</em>sin(\alpha/2)，c*sin(\alpha/2)]^T<br>
$$<br>
欧拉角和四元数转换过程中，需要注意轴旋转顺序，此处旋转顺序为ZYX。根据旋转复合，可得：</p>
<center><img lazyload="" src="/images/loading.svg" data-src="img-1.png"></center>
<p><a class="link" target="_blank" rel="noopener" href="https://item.kongfz.com/book/62834881.html">多旋翼飞行器设计与控制<i class="fa-solid fa-up-right-from-square"></i></a> P100-103</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-free-music"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/free-music/"
    >Free Music</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/free-music/" class="article-date">
  <time datetime="2022-07-20T09:59:26.000Z" itemprop="datePublished">2022-07-20</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1>免费音乐下载网站(工具)</h1>
<p><a target="_blank" rel="noopener" href="http://www.musictool.top/">音乐搜索器 - 多站合一音乐搜索,音乐在线试听 (musictool.top)</a></p>
<p><strong>优点：</strong></p>
<ol>
<li>音源丰富</li>
</ol>
<p><strong>不足：</strong></p>
<ol>
<li>无法选择音质</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://tools.liumingye.cn/music/?page=searchPage">搜索 - MYFREEMP3 - 無料音楽ダウンロード - 무료 음악 다운로드 - Free Mp3 Download (liumingye.cn)</a></p>
<p><a target="_blank" rel="noopener" href="https://sacdr.net/">易音论坛 - 发烧级音乐资源分享，专业级HIFI设备讨论 - SACDR.NET</a></p>
<p><a target="_blank" rel="noopener" href="http://www.gequdaquan.net/gqss/">歌曲大全-音乐聚合搜索引擎-音乐免费下载mp3-音乐免费下载 (gequdaquan.net)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.aigei.com/">爱给网_音效配乐_3D模型_视频素材_游戏素材_免费下载 (aigei.com)</a></p>
<ul>
<li>音乐素材</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.51ape.com/s.php">无损音乐下载 - 搜索结果 - 51Ape.Com</a></p>
<p><a target="_blank" rel="noopener" href="http://listen1.github.io/listen1/">Listen 1 音乐播放器</a></p>
<p><a target="_blank" rel="noopener" href="https://music.zhuolin.wang/">VIP会员付费音乐解析下载网 (zhuolin.wang)</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-TheNatureofCode-Vector"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/TheNatureofCode-Vector/"
    >The Nature of Code:Pvector</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/TheNatureofCode-Vector/" class="article-date">
  <time datetime="2022-07-11T02:39:11.000Z" itemprop="datePublished">2022-07-11</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="categories/Processing/">Processing</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1>向量(Vectors)</h1>
<p><a target="_blank" rel="noopener" href="https://natureofcode.com/book/chapter-1-vectors/">The Nature of Code-Vectors</a></p>
<p>向量是Processing编程中的基本模块，向量又叫矢量(Euler Vector)，定义为有方向和大小的实体。向量通常用箭头表示，箭头的指向就是向量的方向，箭头的长度就是向量的大小。</p>
<img src="https://natureofcode.com/book/imgs/chapter01/ch01_01.png">
<h2 id="Vectors-You-Complete-Me">Vectors,You Complete Me.</h2>
<p>在详细介绍向量之前，先通过一个例子来论证向量的重要性，以至于我们会从向量开始。</p>
<p><strong>Example 1.1 Bouncing ball with no Vectors</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> x = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">float</span> y = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">float</span> xspeed = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">float</span> yspeed = <span class="number">3.3</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//Move the ball according to its speed.</span></span><br><span class="line">  x = x + xspeed;</span><br><span class="line">  y = y + yspeed;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//Check for bouncing.</span></span><br><span class="line">  <span class="keyword">if</span> ((x &gt; width) || (x &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">    xspeed = xspeed * -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((y &gt; height) || (y &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">    yspeed = yspeed * -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  stroke(<span class="number">0</span>);</span><br><span class="line">  fill(<span class="number">175</span>);</span><br><span class="line"><span class="comment">//Display the ball at the location (x,y).</span></span><br><span class="line">  ellipse(x,y,<span class="number">16</span>,<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子实现了一个弹跳球。这个球具有一些属性包括：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Location <span class="comment">//x and y</span></span><br><span class="line">Speed <span class="comment">//xspeed and yspeed</span></span><br></pre></td></tr></table></figure>
<p>当然，可以想象它还可能会有更多的变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Acceleration <span class="comment">//xacceleration and yacceleration</span></span><br><span class="line"></span><br><span class="line">Target location <span class="comment">//xtarget and ytarget</span></span><br><span class="line"></span><br><span class="line">Wind <span class="comment">//xwind and ywind</span></span><br><span class="line"></span><br><span class="line">Friction <span class="comment">//xfriction and yfriction</span></span><br></pre></td></tr></table></figure>
<p>使用向量能让我们的代码更加简洁，比如二维空间中的位置和速度例子中，一般的实现需要四个变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> x;</span><br><span class="line"><span class="keyword">float</span> y;</span><br><span class="line"><span class="keyword">float</span> xspeed;</span><br><span class="line"><span class="keyword">float</span> yspeed;</span><br></pre></td></tr></table></figure>
<p>如果使用Vector表示则可以简化成：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Vector location<span class="comment">;</span></span><br><span class="line">Vector speed<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>编程中使用vector并不会让草图出现什么神奇的变化，但是它能简化代码，并且能提供一些数学函数供使用。开始介绍向量的时候，将不会涉及到3维空间，但是这些例子能很简单就扩展到三维空间中，因为向量类—<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector</span> 支持三维空间向量。</p>
<h2 id="Vectors-for-Processing-Programmers">Vectors for Processing Programmers</h2>
<p>理解向量的一种方法是它和两个点的区别。考虑一下如何按照指示从一个点到另外一个点。下面是一些例子：</p>
<img src="https://natureofcode.com/book/imgs/chapter01/ch01_02.png">
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">-15</span>, <span class="number">3</span>)</span><br><span class="line">Walk fifteen steps west; turn <span class="keyword">and</span> walk <span class="literal">three</span> steps north.</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">Walk <span class="literal">three</span> steps east; turn <span class="keyword">and</span> walk <span class="literal">five</span> steps north.</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>, <span class="number">-1</span>)</span><br><span class="line">Walk <span class="literal">two</span> steps east; turn <span class="keyword">and</span> walk <span class="literal">one</span> step south.</span><br></pre></td></tr></table></figure>
<p>在之前的Processing编程中可能也接触过类似的情况，比如指示屏幕上的每个对象水平移动一定数量的像素和垂直移动一定数量的像素。</p>
<img src="https://natureofcode.com/book/imgs/chapter01/ch01_03.png">
<p>对于每一帧，有：</p>
<p><strong>new location = velocity applied to current location</strong></p>
<p>如果速度(velocity)是一个向量，那么位置(position)到底是不是向量？有的说不是，因为位置描述的是空间中的一个点，这和之前的向量描述怎样从一个点运动到另一个点不同。尽管这样，从另外一个角度看，位置可以看成是从原点到所处位置的路径，因此位置可以表示所处位置和原点的相对位置。</p>
<img src="https://natureofcode.com/book/imgs/chapter01/ch01_04.png">
<p>以弹跳球为例讨论位置(location)和速度(velocity)数据，在上面的代码中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location x,y</span><br><span class="line"></span><br><span class="line">velocity xspeed,yspeed</span><br></pre></td></tr></table></figure>
<p>如果我们自己实现一个vector类来保存速度或者位置中的两个变量:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PVector</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">float</span> x;</span><br><span class="line">  <span class="keyword">float</span> y;</span><br><span class="line"> </span><br><span class="line">  PVector(<span class="keyword">float</span> x_, <span class="keyword">float</span> y_) &#123;</span><br><span class="line">    x = x_;</span><br><span class="line">    y = y_;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从本质上讲，<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector</span>是一种存储两个变量的很方便的方法(或者三维空间中的三个变量)。</p>
<p>如果使用向量，则原来的代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> x = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">float</span> y = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">float</span> xspeed = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">float</span> yspeed = <span class="number">3.3</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>会变成下面这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PVector location = <span class="keyword">new</span> PVector(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">PVector velocity = <span class="keyword">new</span> PVector(<span class="number">1</span>,<span class="number">3.3</span>);</span><br></pre></td></tr></table></figure>
<p>有了位置和速度两个向量对象之后，我们对其应用<strong>location = location + velocity</strong>，则会从原来的代码：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">x</span> = x + xspeed<span class="comment">;</span></span><br><span class="line"><span class="attr">y</span> = y + yspeed<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>变成：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">= location</span> + velocity;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>但是在Processing中，&quot;+&quot;号运算符仅能用于原始值(整数、浮点等)的计算，不能直接用作将对两个<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector</span>对象相加，<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector</span>有其自身对应的数学运算函数。</p>
<h2 id="Vector-Addition">Vector Addition</h2>
<p>正式开始使用<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector</span>类的<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">add()</span>函数之前，先从数学角度简单介绍一下向量的加法。向量通常是用粗体或者符号上带有一个箭头符号来表示。为了区分向量(vector)和标量(scale，表示单个数，比如整数或者浮点)，书中使用的是带箭头的符号。</p>
<ul>
<li>向量：$\overrightarrow{x}$</li>
<li>标量：$x$</li>
</ul>
<p>对于如下两个变量：</p>
<img src="https://natureofcode.com/book/imgs/chapter01/ch01_05.png">
<p>每个向量有两个元素，x、y。两个向量相加，只需要简单的讲其各自的x和y相加即可。</p>
<img src="https://natureofcode.com/book/imgs/chapter01/ch01_06.png">
<p>换句话说，$\overrightarrow{w}=\overrightarrow{u}+\overrightarrow{v}$，可以写成：<br>
$$<br>
w_x=u_x+v_x\<br>
w_y=u_x+v_x<br>
$$<br>
既然已经理解了向量的加法，那么就可以在之前自己实现的<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector</span>类中新增一个<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">add()</span>函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PVector</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">float</span> x;</span><br><span class="line">  <span class="keyword">float</span> y;</span><br><span class="line"> </span><br><span class="line">  PVector(<span class="keyword">float</span> x_, <span class="keyword">float</span> y_) &#123;</span><br><span class="line">    x = x_;</span><br><span class="line">    y = y_;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//New! A function to add another PVector to this PVector. Simply add the x components and the y  components together.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(PVector v)</span> </span>&#123;</span><br><span class="line">    y = y + v.y;</span><br><span class="line">    x = x + v.x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用向量的思路重新实现例子1.1：</p>
<p><strong>Example 1.2: Bouncing ball with PVectors!</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PVector location;</span><br><span class="line">PVector velocity;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  location = <span class="keyword">new</span> PVector(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">  velocity = <span class="keyword">new</span> PVector(<span class="number">2.5</span>,<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line"> </span><br><span class="line">  location.add(velocity);</span><br><span class="line">  <span class="keyword">if</span> ((location.x &gt; width) || (location.x &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">    velocity.x = velocity.x * -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((location.y &gt; height) || (location.y &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">    velocity.y = velocity.y * -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  stroke(<span class="number">0</span>);</span><br><span class="line">  fill(<span class="number">175</span>);</span><br><span class="line">  ellipse(location.x,location.y,<span class="number">16</span>,<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用向量实现的的弹跳球，相比较起最初的代码看起来更加复杂，但是随着我们进入一个由多个对象和多个力组成的更复杂的系统（我们将在第 2 章中介绍），PVector 的好处将变得更加明显。</p>
<p>然而，我们应该注意上述过渡到向量编程的一个重要方面。 即使我们使用 <span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector()</span>对象来描述两个值——位置的 x 和 y 以及速度的 x 和 y——我们仍然经常需要单独引用每个 <span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector()</span>的 x 和 y 分量。</p>
<p><span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">ellipse()</span>函数不允许将 <span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector()</span>作为参数。 <span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">ellipse()</span>只能用两个标量值绘制，一个 x 坐标和一个 y 坐标。 因此我们必须深入研究 <span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector()</span>对象并使用面向对象的点语法提取 x 和 y 分量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ellipse(location.x,location.y,<span class="number">16</span>,<span class="number">16</span>);</span><br></pre></td></tr></table></figure>
<p>同样的问题出现在边界判断中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((location.x &gt; width) || (location.x &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">  velocity.x = velocity.x * -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="More-Vector-Math">More Vector Math</h2>
<p>向量自带许多数学计算函数；</p>
<ul>
<li>add() — 向量和；</li>
<li>sub() — 向量差；</li>
<li>mult() — 向量缩放(乘法)；</li>
<li>div() — 向量缩放(除法)；</li>
<li>mag() — 向量幅值；</li>
<li>setMag() - 设置向量幅值；</li>
<li>normalize() — 归一化向量(单位向量)；</li>
<li>limit() — 限制向量的幅值；</li>
<li>heading() — 2维平面向量方向，输出为角度；</li>
<li>rotate() — 2维平面向量旋转；</li>
<li>lerp() — 线性插值到另一个向量；</li>
<li>dist() — 两个向量之间的欧几里得距离（看作点）；</li>
<li>angleBetween() — 求两个向量的夹角；</li>
<li>dot() — 点乘两个向量；</li>
<li>cross() — 两个向量的叉积（仅与三个维度相关）；</li>
<li>random2D() - 生成二维空间随机向量；</li>
<li>random3D() - 生成三维空间随机向量；</li>
</ul>
<h3 id="Vector-subtraction">Vector subtraction</h3>
<p>$$<br>
\begin{align}<br>
&amp; \overrightarrow{w}=\overrightarrow{u}-\overrightarrow{v}\<br>
&amp; w_x=u_x-v_x\<br>
&amp; w_y=u_x-v_x<br>
\end{align}<br>
$$</p>
<img src="https://natureofcode.com/book/imgs/chapter01/ch01_07.png">
<p><span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">PVector</span>内部减法实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub</span><span class="params">(PVector v)</span> </span>&#123;</span><br><span class="line">    x = x - v.x;</span><br><span class="line">    y = y - v.y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>向量减法例程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line"><span class="comment">//Two PVectors, one for the mouse location and one for the center of the window</span></span><br><span class="line">  PVector mouse  = <span class="keyword">new</span> PVector(mouseX,mouseY);</span><br><span class="line">  PVector center = <span class="keyword">new</span> PVector(width/<span class="number">2</span>,height/<span class="number">2</span>);</span><br><span class="line"><span class="comment">//PVector subtraction!</span></span><br><span class="line">  mouse.sub(center);</span><br><span class="line"><span class="comment">//Draw a line to represent the vector.</span></span><br><span class="line">  translate(width/<span class="number">2</span>,height/<span class="number">2</span>);</span><br><span class="line">  line(<span class="number">0</span>,<span class="number">0</span>,mouse.x,mouse.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-TheNatureOfCode-Introduction"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/TheNatureOfCode-Introduction/"
    >The Nature of Code:Introduction</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/TheNatureOfCode-Introduction/" class="article-date">
  <time datetime="2022-06-15T03:32:25.000Z" itemprop="datePublished">2022-06-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="categories/Processing/">Processing</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1>Introduction</h1>
<p><a target="_blank" rel="noopener" href="https://natureofcode.com/book/introduction/">The Nature of Code:Introduction</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/nature-of-code/noc-examples-processing">nature-of-code/noc-examples-processing: Repository for example code from The Nature of Code book (github.com)</a></p>
<p>本章将会从最简单的运动仿真——随机游走(random walk)开始。</p>
<h2 id="随机游走-Random-Walks">随机游走(Random Walks)</h2>
<p>随机算法是一种并不复杂的算法，随机算法能够用来为世界中的许多现象建模。比如：气体中分子的运动、赌徒在赌场一天的行为。</p>
<p>以随机游走开始介绍这本书，需要记住以下三点：</p>
<ol>
<li>本书的核心编程思想是——面向对象编程(object-oriented programming)。随机游走器将作为如何使用面向对象设计处理窗口中移动物体的模板；</li>
<li>随机游走引出两个贯穿全书的问题：
<ul>
<li>如何定义控制对象行为的规则；</li>
<li>如何在Processing中应用这些规则；</li>
</ul>
</li>
<li>本书中，需要对随机性、概率和Perlin噪声有基本的了解。随机游走和它们都有关系；</li>
</ol>
<h2 id="随机游走类-The-Random-Walker-Class">随机游走类(The Random Walker Class)</h2>
<p>面向对象编程基本概念：</p>
<ul>
<li>
<p><strong>Object</strong></p>
<p>Processing中的对象(Object)是一个具有数据和功能的实体；</p>
</li>
<li>
<p><strong>Class</strong></p>
<p>类(Class)是用来创建对象的模板；</p>
</li>
</ul>
<p><code>P.S: processing中类介绍</code></p>
<p><a target="_blank" rel="noopener" href="http://processing.org/learning/objects/">basics on the Processing website</a></p>
<h2 id="概率和非正态分布-Probability-and-Non-Uniform-Distributions">概率和非正态分布(Probability and Non-Uniform Distributions)</h2>
<p>计算机图形系统中，产生一个随机数是最很容易的事。然后，我们的目的是使建立的模型更加符合自然界中的特定现象，简单的随机数在这种场景中并不合适，需要调整随机数的使用方法。尤其是在涉及到进化或仿自然仿真(natural-looking simulation)中。仅仅需要一点小技巧就能改变random()方法来产生非正态分布。比如，在进化模型中，该如何选择哪个个体的DNA遗传给下一代？根据达尔文的进化理论——“适者生存”，一个猴群中强壮的、速度快的个体有90%的概率得到繁殖的机会，其余个体只有10%的机会。</p>
<p>首先对概率(probability)的基本概念进行介绍。在独立事件中，概率就是一个事件发生的可能性(likehood)。一个有限可能结果的系统中，某特定事件的概率等于符合该事件的结果数除以所有可能结果的总数。抛硬币就是一个简单的例子，正面朝上及背面朝上的两种结果看来概率相同，每个的概率都是1/2，也就是正面朝上及背面朝上的概率各有50%。多个独立事件发生的概率等于每个事件的概率相乘。</p>
<p>比如连续抛掷三次硬币，都是正面朝上的概率表示为：<br>
$$<br>
(1/2)<em>(1/2)</em>(1/2)=1/8(or0.125)<br>
$$</p>
<p>有几种方法可以在代码中使用带有概率的 random() 函数。第一种是<strong>数组方式</strong>，将有限结果事件全部存储在一个数组中，然后调用random()产生事件指针，根据数组输出结果，这种实现方式中，事件发生的概率由数组中的内容决定。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> [] stuff = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>];</span><br><span class="line">stuff[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">stuff[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">stuff[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">stuff[<span class="number">3</span>] = <span class="number">3</span>;</span><br><span class="line">stuff[<span class="number">4</span>] = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">int</span> index = <span class="keyword">int</span>(random(stuff.length));</span><br><span class="line"><span class="keyword">int</span> outcome = stuff[index];</span><br></pre></td></tr></table></figure>
<p>运行上面的代码，有<code>outcome</code>为1的概率是2/5，2的概率为1/5，3的概率是1/5，4的概率为1/5；</p>
<p>另外一种方式是生成一个随机数(浮点型0~1)，输出结果有随机数的范围决定。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> num = random(<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">If random number is less than <span class="number">0.6</span></span><br><span class="line"><span class="keyword">if</span> (num &lt; <span class="number">0.6</span>) &#123;</span><br><span class="line">  println(<span class="string">&quot;Outcome A&quot;</span>);</span><br><span class="line">Between <span class="number">0.6</span> and <span class="number">0.7</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (num &lt; <span class="number">0.7</span>) &#123;</span><br><span class="line">  println(<span class="string">&quot;Outcome B&quot;</span>);</span><br><span class="line">Greater than <span class="number">0.7</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  println(<span class="string">&quot;Outcome C&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="随机正态分布-A-Normal-Distribution-of-Random-Numbers">随机正态分布( A Normal Distribution of Random Numbers)</h2>
<p>自然界中的很多现象能使用正态分布来描述，比如人的身高分布，大部分的人身高在平均身高附近，很高或者很矮的人所占的比例很少，random()函数生成的随机数不能描述这种现象。</p>
<p>正态分布指的是数值分布聚集在均值附近。也叫高斯分布(Gaussian distribution)。将分布绘制成图就是下面这种钟形图。</p>
<table>
    <tr>
        <td><img src="https://natureofcode.com/book/imgs/intro/intro_02.png"></td>
        <td><img src="https://natureofcode.com/book/imgs/intro/intro_03.png"></td>
    </tr>
</table>
<p>上面的曲线是由一个数学函数生成，该函数将任何给定值出现的概率定义为均值(μ)和标准(σ)的函数。对于上面的曲线，均值决定最高点的位置，方差决定了最高点的值，右边的方差比左边的方差值更大，表示分布离散度更高。高斯分布特点：</p>
<ul>
<li>在μ±σ范围的值占比：68%；</li>
<li>μ±2σ范围的值占比：98%；</li>
<li>μ±3σ范围的值占比：99.7%；</li>
</ul>
<div style=" color: #191919;background-color: #E9E9E9;">
    <p>均值和方差计算</p>
    <p>给定以下数值:
    <br>
        <em>85, 82, 88, 86, 85, 93, 98, 40, 73, 83</em><br>
    均值:81.3<br>
        标准差:15.13</p>
</div>
<p>$$<br>
均值: \mu = \frac{1}{m}\sum^m_{i=1}x^{(i)}\<br>
方差:\sigma^2 = \frac{1}{m}\sum_{i=1}^{m}(x^{(i)} - \hat{\mu})^2\<br>
标准差:\sigma=\sqrt{\frac{1}{m}\sum_{i=1}^{m}(x^{(i)} - \hat{\mu})^2}<br>
$$<br>
Processing提供了<strong>Random</strong>类用以处理随机数。</p>
<ol>
<li>
<p>随机数生成器申明和定义；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Random generator;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	size(<span class="number">400</span>,<span class="number">400</span>);</span><br><span class="line">	generator=<span class="keyword">new</span> Random();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>生成服从高斯分布的随机数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// nextGaussian输出的是double类型数据</span></span><br><span class="line">    <span class="keyword">float</span> new_value=(<span class="keyword">float</span>)generator.nextGaussian();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">nextGaussian()</span>函数生成的数服从标准正态分布(均值为0，方差为1)。不同场景下，比如需要绘制均值为200，标准差为60的分布图，只需要将<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">nextGaussian()</span> 生成的数乘标准差，然后再加上均值即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> sd = <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">float</span> mean_v = <span class="number">200</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">float</span> num = (<span class="keyword">float</span>)generator.nextGaussian();</span><br><span class="line">    <span class="keyword">float</span> x = sd*num+mean_v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义随机分布-A-Custom-Distribution-of-Random-Numbers">自定义随机分布(A Custom Distribution of Random Numbers)</h2>
<p>很多时候，我们真正需要的并不是一个正态分布随机数，比如Gaussian。比如，想象一下一个随机游走的寻找食物的过程。在一个范围内随机寻找是一个常用的技巧，毕竟在找到食物之前并不知道它们存放在那里。但是，随机寻找存在一个问题，那就是会回到之前已经到过的地方(过采样,oversampling)。为了避免这种问题，一个经常使用的策略就是每次走很大一步，这允许步行者在特定位置周围随机觅食，同时定期跳得很远以减少过采样。随机游走（称为 Lévy flight）的这种变化需要一组自定义的概率。 虽然不是 Lévy flight的精确实现，但我们可以将概率分布表述如下：步长越长，被选中的可能性越小； 步骤越短，可能性越大。</p>
<p>在前面序言中，介绍了可以通过用值填充数组（一些值是重复的以便更高频率选择到）或通过比较random() 的结果来生成自定义概率分布。 比如有通过有 1% 的机会迈出一大步来实现 Lévy flight。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> r=random();</span><br><span class="line"><span class="keyword">if</span> (r&lt;<span class="number">0.01</span>)</span><br><span class="line">&#123;</span><br><span class="line">	xstep=random(-<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">	ystep=random(-<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	xstep = random(-<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	ystep = random(-<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，这会将概率降低到固定数量的选项。如果想制定一个更普遍的规则——数字越大，被选中的可能性就越大呢？ 3.145 比 3.144 更有可能被选中，即使这种可能性只是稍微大一点。 换句话说，如果 x 是随机数，我们可以用 y = x 在 y 轴上映射概率。</p>
<img src="https://natureofcode.com/book/imgs/intro/intro_04.png">
<p>如果我们能够根据上图弄清楚如何生成随机数的分布，那么我们将能够将相同的方法应用于任何曲线。</p>
<p>一种解决方案是选择两个随机数而不是一个。 第一个随机数作为待比较随机数，第二个是“比较随机值”。 它决定使用第一个还是舍弃并选择另一个。较容易获得资格的号码将被更频繁地挑选，而很少符合资格的号码将不经常被挑选。 以下是步骤（现在，我们只考虑 0 到 1 之间的随机值）：</p>
<ol>
<li>生成随机数：R1；</li>
<li>计算 R1 应该符合条件的概率 P。假设：P = R1；</li>
<li>生成随机数：R2；</li>
<li>如果 R2 小于 P，那么选择R1；</li>
<li>如果 R2 不小于 P，则返回步骤 1 并重新开始；</li>
</ol>
<p>在这里，我们说随机值符合条件的可能性等于随机数本身。 假设我们为 R1 选择 0.1。 这意味着 R1 将有 10% 的机会获得资格。 如果我们为 R1 选择 0.83，那么它将有 83% 的机会获得资格。 数字越高，我们实际使用它的可能性就越大。  这是一个实现上述算法的函数（以蒙特卡洛方法命名，以蒙特卡洛赌场命名），返回一个介于 0 和1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">montecarlo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">float</span> r1=random(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">float</span> probility=r1;</span><br><span class="line">        <span class="keyword">float</span> r2=random(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (r2&lt;probility)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> r1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Perlin噪声-Perlin-Noise-A-Smoother-Approach">Perlin噪声(Perlin Noise (A Smoother Approach))</h2>
<p>一个好的随机数生成器产生的数字之间没有关系，也没有明显的模式。正如我们开始看到的，在编写有机的、栩栩如生的行为时，一点点随机性可能是一件好事。然而，作为单一指导原则的随机性并不一定是自然的。一种被称为“Perlin 噪声”的算法（以其发明者 Ken Perlin 命名）考虑了这一点。 Perlin 在 1980 年代初制作原始 Tron 电影时开发了噪声功能；它旨在为计算机生成的效果创建程序纹理。 1997 年，佩林因这项工作获得了奥斯卡技术成就奖。 Perlin 噪声可用于生成具有自然品质的各种效果，例如云、风景和大理石等图案纹理。  Perlin 噪声具有更有机的外观，因为它产生自然有序（“平滑”）的伪随机数序列。左下图显示了 Perlin 噪声随时间的变化，x 轴代表时间；注意曲线的平滑度。右图显示随时间变化的纯随机数。</p>
<table>
    <tr>
        <td><img src="https://natureofcode.com/book/imgs/intro/intro_05.png" ></td>
        <td><img src="https://natureofcode.com/book/imgs/intro/intro_06.png" ></td>
    </tr>
</table>
<p>Processing 有一个 Perlin 噪声算法的内置实现：函数<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>。<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span> 函数可以输入一个、两个或三个参数，因为噪声是在一维、二维或三个维度上计算的。从一维噪声开始。</p>
<div style=" color: #191919; padding: 1.4em 1.5em;margin: 1.15em 0; background-color: #E9E9E9;">
    <p>
        Processing中noise()是在几个“八度音阶”上计算的。 调用 noiseDetail() 函数将改变八度音阶的数量及其相对于彼此的重要性。 这反过来又改变了噪声函数的行为方式。
    </p>
    <p><a target="_blank" rel="noopener" href="http://www.noisemachine.com/talk1/"> Perlin Noise Detail </a></p>
</div>
<p><span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>函数理解。假如我们需要生成一个在某一范围内的随机数，<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">random()</span>函数输入一个参数，表示生成一个0-参数值范围内的随机数。但是这种方法并不是<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>函数的正确使用方法。如果像<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">random()</span>一样， 给<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>输入一个参数，得到的结果将是一个0-1范围之内的固定值。实际上，Perlin噪声可以认为是一个随时间线性变化的一系列值。例如：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Time</th>
<th style="text-align:center">Noise</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0.365</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0.363</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">0.363</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">0.364</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">0.366</td>
</tr>
</tbody>
</table>
<p>因此在Processing中为了获取特定的噪声值，需要给<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>函数输入一个特定的&quot;时间参数&quot;。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> t_value = <span class="number">3</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> n = noise(t_value);</span><br><span class="line">    println(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码会持续输出固定值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> t_value=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> n = noise(t_value);</span><br><span class="line">    t_value +=<span class="number">1</span>;</span><br><span class="line">    println(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码会输出不同的随机值。</p>
<p><em>t_value</em> 变化快慢会影响噪声的光滑度；如果我们在时间上有很大的跳跃，那么我们就会向前跳跃，并且值会更加随机。</p>
<img src="https://natureofcode.com/book/imgs/intro/intro_07.png">
<h3 id="噪声值映射-Mapping-Noise">噪声值映射(Mapping Noise)</h3>
<p><span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>函数生成的值范围是0~1，使用<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">map()</span>函数能将这些值映射到任意的范围，<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">map()</span>函数需要五个参数。</p>
<img src="https://natureofcode.com/book/imgs/intro/intro_08.png">
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> t = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">float</span> n = noise(t);</span><br><span class="line"><span class="comment">//Using map() to customize the range of Perlin noise</span></span><br><span class="line">  <span class="keyword">float</span> x = map(n,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,width);</span><br><span class="line">  ellipse(x,<span class="number">180</span>,<span class="number">16</span>,<span class="number">16</span>);</span><br><span class="line"> </span><br><span class="line">  t += <span class="number">0.01</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二维噪声-Two-Dimensional-Noise">二维噪声(Two-Dimensional Noise)</h3>
<p>Processing中Perlin噪声是通过<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>函数实现的，相比较于另外一个随机数生成函数<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">random()</span>，<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>最大的不同点是：调用此函数生成的噪声曲线更光滑，这是因为其相邻数值变化更小。对于一维Perlin噪声，某个数有两个与它直接相邻(左图)。对于二维Perlin噪声，其相邻数据是在网格中一个格子周边的所有单个格子中的数据(如右图)。</p>
<table>
    <tr>
        <td> <img src="https://natureofcode.com/book/imgs/intro/intro_10.png"></td>
        <td> <img src="https://natureofcode.com/book/imgs/intro/intro_11.png"></td>
    </tr>
</table>
<p>从概念上看，二维噪声和一维噪声的实现方式相同。不同之处在于其相邻点的存在方式和个数，一位是一条线相邻的两点，二维是网格周边所有的单个格子。给定值将的相邻点在其：上方、下方、右侧、左侧以及沿任何对角线。如果您要将这张方格纸可视化，并将每个值映射到颜色的亮度，会得到看起来像云的东西。 白色旁边是浅灰色，灰色旁边是灰色，深灰色旁边是黑色，黑色旁边是深灰色，等等。</p>
<img src="https://natureofcode.com/book/imgs/intro/intro_ex06.png">
<p>这就是最初发明噪音的原因。可以稍微调整参数或使用颜色，以使生成的图像看起来更像大理石或木材或任何其他有机纹理。</p>
<p>二维噪声的实现：如果想为窗口的每个像素随机着色，可以通过一个<strong>嵌套循环</strong>来实现，这样能访问每个像素点并选择随机亮度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">loadPixels();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">0</span>;x&lt;width;x++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">0</span>;y&lt;height;y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">float</span> brightness = random(<span class="number">255</span>);</span><br><span class="line">        pixels[x+y*width]=color(brightness);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">updatePixels();</span><br></pre></td></tr></table></figure>
<p>如果使用<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>调整每个像素点的颜色，其实现方式也很简单，只需要把<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">random()</span>替换为<span style ="font-family: Menlo, Monaco, Consolas, monospace;font-size: 16px;">noise()</span>即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> bright = map(noise(x,y),<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">255</span>);</span><br></pre></td></tr></table></figure>
<p>2D Perlin噪声的具体实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> xoff = <span class="number">0.0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; width; x++) &#123;</span><br><span class="line"><span class="comment">//For every xoff, start yoff at 0.</span></span><br><span class="line">  <span class="keyword">float</span> yoff = <span class="number">0.0</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; height; y++) &#123;</span><br><span class="line"><span class="comment">//Use xoff and yoff for noise().</span></span><br><span class="line">    <span class="keyword">float</span> bright = map(noise(xoff,yoff),<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">255</span>);</span><br><span class="line"><span class="comment">//Use x and y for pixel location.</span></span><br><span class="line">    pixels[x+y*width] = color(bright);</span><br><span class="line"><span class="comment">//Increment yoff.</span></span><br><span class="line">    yoff += <span class="number">0.01</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//Increment xoff.</span></span><br><span class="line">  xoff += <span class="number">0.01</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<table>
    <tr>
        <td><img src="https://cdn.jsdelivr.net/gh/Joiner12/PicBed@main/image-20220705101319316.png" style="width:500px;height:250px;">
            <br>
            <p style="font-size:20px;">random函数生成二维随机颜色</p>
        </td>
        <td><img src="https://cdn.jsdelivr.net/gh/Joiner12/PicBed@main/image-20220705101201719.png" style="width:500px;height:250px;">
        <br>
            <p style="font-size:20px;">noise函数生成二维随机颜色</p>
        </td>
    </tr>
</table>
<p>在本节中，介绍了 Perlin 噪声的几种典型用法。 对于一维噪声，使用平滑值来设置对象的位置，从而呈现出徘徊的外观。 使用二维噪声，在像素平面上创建了具有平滑值的多云图案。 然而，Perlin 噪声值就是特定的数值，它们本质上与像素位置或颜色无关，只是对其值的进行使用。本书中任何具有变量的示例都可以通过 Perlin 噪声进行控制。比如对风力建模时，它的强度可以由Perlin噪声控制。分形树模式中分支之间的角度或流场模拟中沿网格移动的对象的速度和方向也是如此。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-TheNatureOfCode-ParticleSystem"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/TheNatureOfCode-ParticleSystem/"
    >The Nature of Code:Particle System</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/TheNatureOfCode-ParticleSystem/" class="article-date">
  <time datetime="2022-05-25T07:39:07.000Z" itemprop="datePublished">2022-05-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="categories/Processing/">Processing</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <hr>
<h1>粒子系统(Particle Systems)</h1>
<p><a target="_blank" rel="noopener" href="https://natureofcode.com/book/chapter-4-particle-systems/">Click Here Jump To Source Page—The Nature of Code</a></p>
<p>​	粒子系统是由许多单个粒子的集合，所有这些单个粒子的集合用来表示一个模糊的物体。一段时间内，粒子在系统中生成、移动、变化最后消失。粒子系统是一种在计算机图形中非常常见且有用的技术。</p>
<p>​	自 1980 年代初以来，粒子系统已被用于无数视频游戏、动画、数字艺术作品和装置中，用以模拟各种不规则类型的自然现象，例如火、烟、瀑布、雾、草、气泡等。</p>
<p>​	本章重点介绍粒子系统编码的实现。包括：</p>
<ul>
<li>如何组织代码；</li>
<li>在哪里存储单个粒子相关信息而不是整个粒子系统的信息；</li>
<li>…</li>
</ul>
<p>​	虽然本章内容为粒子使用简单的形状和最基本的行为(重力)，但是基于此框架应用更复杂的方式构建粒子和行为，可以实现各种不同的效果。</p>
<h2 id="为什么需要粒子系统？">为什么需要粒子系统？</h2>
<ol>
<li>
<p>使用粒子系统能够对例如烟、火、瀑布等已经列出来的自然现象进行建模；</p>
</li>
<li>
<p>更为抽象的意义就是：使用粒子系统的思路来处理需要面对的大量（<em>many</em>）对象编码过程；之前章节在处理大量对象的过程中使用的是数组的方式来实现，粒子系统能够提供一种超越数组的方式‘；</p>
</li>
<li>
<p>编写多个类，以及用以保存其他类实例的类编程思想；</p>
<p>粒子系统中，需要更加灵活的处理元素数量的方法，除了编写单个粒子的类之外还要实现一个描述粒子集合的类—粒子系统本身。本章的目标是能够实现如下的程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ParticleSystem ps;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line">  ps.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码中，没有对单个粒子类进行显示引用，但是能够实现整个粒子系统。这是一种非常有用的面向对象编程方式—编写多个类，以及用以保存其他类实例的类。</p>
</li>
<li>
<p>使用另外两种高级面向对象编程（object-oriented programming）的方法：继承(inheritance )和多态(polymorphism)。</p>
<p>通过继承（和多态），我们将学习一种方便的方法来存储包含不同类型对象的单个列表。 这样，粒子系统不仅需要是单一类型粒子的系统。</p>
</li>
</ol>
<p>​</p>
<h2 id="单个粒子">单个粒子</h2>
<p>​	粒子系统是由多个粒子组成的，开始实现系统之前，先实现描述单个粒子的类。第二章中的<code>Mover</code>类可以作为一个很好的模板进行使用。实际上粒子是一个能在屏幕上运动的物体。它具有location、velocity、acceleration，一个用以初始化上述变量的结构体，一个用以显示和更新的函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  <span class="comment">//[full] A “Particle” object is just another name for our “Mover.” It has location, velocity, and acceleration.</span></span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    location = l.get();</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector();</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">0</span>);</span><br><span class="line">    fill(<span class="number">175</span>);</span><br><span class="line">    ellipse(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>​	上面为一个最简单的单粒子定义，此外可以添加一个*applyfoce()*函数控制粒子的运动。添加变量来描述粒子的颜色和形状，或者引用 PImage 来绘制粒子。接下来重点关注一个附加项：<em><strong>生命周期（lifespan）</strong></em>。</p>
<p>​	典型的粒子系统涉及一种称为***发射器（emitter）***的东西。发射器是粒子的来源，并控制粒子、位置、速度等的初始设置。发射器可能会发射单个粒子爆发，或连续的粒子流，或两者兼而有之。关键是对于这样的典型实现，粒子在发射器处诞生，但不会永远存在。如果它要永远存在，我们的 Processing 草图最终会随着时间的推移随着粒子数量增加到一个难以处理的数字而停止。随着新粒子的诞生，我们需要旧粒子死亡。这会产生无限粒子流的错觉，并且我们的程序的性能不会受到影响。有许多不同的方法可以决定粒子何时死亡。例如，它可能会接触到另一个物体，或者它可能只是离开屏幕。然而，对于我们的第一个粒子类，我们只是要添加一个寿命变量。计时器将从 255 开始并倒计时至 0，此时粒子将被视为“死亡”。所以我们扩展粒子类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="comment">// A new variable to keep track of how long the particle</span></span><br><span class="line">  <span class="comment">// has been “alive”</span></span><br><span class="line">  <span class="keyword">float</span> lifespan; <span class="comment">//[bold]</span></span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    location = l.get();</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector();</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector();</span><br><span class="line">    <span class="comment">// We start at 255 and count down for convenience</span></span><br><span class="line">    lifespan = <span class="number">255</span>; <span class="comment">//[bold]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">    <span class="comment">// Lifespan decreases</span></span><br><span class="line">    lifespan -= <span class="number">2.0</span>; <span class="comment">//[bold]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Since our life ranges from 255 to 0 we can use it for alpha</span></span><br><span class="line">    stroke(<span class="number">0</span>, lifespan); <span class="comment">//[bold]</span></span><br><span class="line">    fill(<span class="number">175</span>, lifespan); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">    ellipse(location.x, location.y, <span class="number">8</span>, <span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询函数</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isDead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Is the particle still alive?</span></span><br><span class="line">    <span class="keyword">if</span> (lifespan &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们选择从 255 开始生命周期并倒计时到 0 的原因是为了方便。 有了这些值，我们也可以指定<em>lifespan</em>来充当椭圆的Alpha 透明度。 当粒子“死”时，它也会在屏幕上消失。</p>
<p>​	加上 <em>lifespan</em> 变量，我们还需要一个额外的函数——一个可以查询（判断真假答案）粒子是&quot;活&quot;还是&quot;死&quot;的函数。 这在我们编写 ParticleSystem 类时会派上用场，该类的任务是管理粒子列表本身。 编写这个函数很容易； 我们只需要检查<em>lifespan</em>的值是否小于0。如果是我们返回<em>true</em>，否则返回<em>false</em>。</p>
<p>验证单粒子运行</p>
<p><code>Particlesystem.pde</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// import</span></span><br><span class="line">Particle singleParticle;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  size(<span class="number">500</span>, <span class="number">500</span>);</span><br><span class="line">  <span class="comment">// initialization single particle</span></span><br><span class="line">  PVector initialPos = <span class="keyword">new</span> PVector(random(width/<span class="number">2</span>-<span class="number">50</span>, width/<span class="number">2</span>+<span class="number">50</span>), <span class="number">0</span>);</span><br><span class="line">  singleParticle = <span class="keyword">new</span> Particle(initialPos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line">  singleParticle.run();</span><br><span class="line">  <span class="keyword">if</span> (singleParticle.isDead()) &#123;</span><br><span class="line">    println(<span class="string">&quot;Particle dead!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>Particle.pde</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="comment">// A new variable to keep track of how long the particle</span></span><br><span class="line">  <span class="comment">// has been “alive”</span></span><br><span class="line">  <span class="keyword">float</span> lifespan; <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    location = l.get();</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>, <span class="number">0.05</span>);</span><br><span class="line">    velocity =  <span class="keyword">new</span> PVector(random(-<span class="number">1</span>, <span class="number">1</span>), random(-<span class="number">2</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="comment">// We start at 255 and count down for convenience</span></span><br><span class="line">    lifespan = <span class="number">255</span>; <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">    <span class="comment">// Lifespan decreases</span></span><br><span class="line">    lifespan -= <span class="number">2.0</span>; <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Since our life ranges from 255 to 0 we can use it for alpha</span></span><br><span class="line">    stroke(<span class="number">0</span>, lifespan); <span class="comment">//</span></span><br><span class="line">    fill(<span class="number">175</span>, lifespan); <span class="comment">//</span></span><br><span class="line">    ellipse(location.x, location.y, <span class="number">8</span>, <span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询函数</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isDead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Is the particle still alive?</span></span><br><span class="line">    <span class="keyword">if</span> (lifespan &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    update();</span><br><span class="line">    display();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>现在我们有了一个描述单个粒子的类，我们已经准备好迈出下一步了。 当我们无法确定在任何给定时间我们可能拥有多少粒子时，我们如何跟踪许多粒子？</p>
<h2 id="动态数组">动态数组</h2>
<h3 id="动态数组-2">动态数组</h3>
<p>​	实际上，可以使用数组(Array)来管理粒子系统中的多个粒子对象。对于粒子数量固定的粒子系统来说，使用数组是非常有效的方法。Processing同时也提供了，expand()、contract()、subset()、splice()函数来调整数组大小。但是，这章中将会使用Java自带类ArrayList(<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/6/docs/api/java/util/ArrayList.html">ArrayList (Java Platform SE 6) (oracle.com)</a>)来代替Array管理粒子。</p>
<p>使用ArrayList和使用Array存储粒子对象的思想是一样的，只是语法不同。</p>
<p>如下代码分别使用ArrayList和Array实现的效果是一致的；</p>
<p><strong>数组方法实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> total = <span class="number">10</span>;</span><br><span class="line">Particle[] parray = <span class="keyword">new</span> Particle[total];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parray.length; i++) &#123;</span><br><span class="line">    parray[i] = <span class="keyword">new</span> Particle();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parray.length; i++) &#123;</span><br><span class="line">    Particle p = parray[i];</span><br><span class="line">    p.run();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ArrayList实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> total = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Particle&gt; plist = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; total; i++) &#123;</span><br><span class="line">    <span class="comment">// An object is added to an ArrayList with add().</span></span><br><span class="line">    plist.add(<span class="keyword">new</span> Particle());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// The size of the ArrayList is returned by size().</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; plist.size(); i++) &#123;</span><br><span class="line">    <span class="comment">// An object is accessed from the ArrayList with get(). </span></span><br><span class="line">    Particle p = plist.get(i);</span><br><span class="line">    p.run();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ArrayList中的加强for循环，':'操作符。</p>
<h3 id="加强for循环操作符’-’">加强for循环操作符’:’</h3>
<p>对于ArrayList&lt;Particle&gt; 类可以使用’:'操作符号替换for，使得for迭代更加优雅、简洁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标准for循环</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;plist.size();i--)</span><br><span class="line">&#123;</span><br><span class="line">    Particle p=plist.get(i);</span><br><span class="line">    p.run();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ‘:’操作符号</span></span><br><span class="line"><span class="keyword">for</span> (Particle p : plist)</span><br><span class="line">&#123;</span><br><span class="line">    p.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="动态调整数组大小">动态调整数组大小</h3>
<p>​	要求：在粒子系统中，实现每个draw循环周期新增一个粒子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Particle&gt; particles;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line">  <span class="comment">// A new Particle object is added to the ArrayList every cycle through draw().</span></span><br><span class="line">  particles.add(<span class="keyword">new</span> Particle(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; particles.size(); i++) &#123;</span><br><span class="line">    Particle p = particles.get(i);</span><br><span class="line">    p.run();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码能够满足要求，但是如果持续运行一段时间，会因为内存消耗过大导致程序崩溃，因为每个draw循环周期向着ArrayList中持续添加元素，ArrayList的大小会不断增大。</p>
<p>对应上述问题，通常我们会想到的方法是，减小ArrayList的元素个数，然后出现如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; particles.size(); i++) &#123;</span><br><span class="line">  Particle p = particles.get(i);</span><br><span class="line">  p.run();</span><br><span class="line">  <span class="comment">//If the particle is “dead,” we can go ahead and delete it from the list.</span></span><br><span class="line">  <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">    particles.remove(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码尽管能够消除ArrayList中元素过多，导致内存占用过大的问题，但是它存在一个很不容易发现的隐患。</p>
<p>通过堆栈的方式来对上面代码进行分析，ArrayList在增加和删除元素的过程中，应该是这样一个过程，</p>
<img src="https://natureofcode.com/book/imgs/chapter04/ch04_01.png">
<p>for循环中，通过指针i的变化，索引到不同的元素：</p>
<ol>
<li>i=0 :arrow_right: 检查粒子A是否消失 :arrow_right: 保留粒子A</li>
<li>i=1:arrow_right: 检查粒子B是否消失 :arrow_right: 保留粒子B</li>
<li>i=2 :arrow_right: 检查粒子C是否消失 :arrow_right: 删除粒子C</li>
<li>(系统自动)将粒子D和粒子E移动到原来粒子C和粒子E所占的内存地址。</li>
</ol>
<p>但是在实现的过程中，由于删除完C时候，i=2，但是D又移动到原来C的位置上，所以这种简单的for循环实现方式并不能对D进行检查，存在漏检问题。针对上面一种情况，有两种解决方法：一种向后(backwards)迭代(iterate)ArrayList、另外一种是使用Jave提供的一种特殊类Iterator。</p>
<p><strong>Iterator</strong> 能够实现：</p>
<ul>
<li>给出下一个元素；</li>
<li>保证迭代过程中，即使出现移除元素也不会出现元素漏掉或二次出现；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Particle&gt; particles;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>, <span class="number">360</span>);</span><br><span class="line">  particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">  particles.add(<span class="keyword">new</span> Particle(<span class="keyword">new</span> PVector(width/<span class="number">2</span>, <span class="number">50</span>)));</span><br><span class="line"></span><br><span class="line">  Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">  <span class="comment">//Using an Iterator object instead of counting with int i</span></span><br><span class="line">  <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">    Particle p = it.next();</span><br><span class="line">    p.run();</span><br><span class="line">    <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">      it.remove();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="粒子系统类-The-Particle-System-Class">粒子系统类(The Particle System Class)</h2>
<p>​	前面的章节已经实现了单个粒子类、使用ArrayList来管理多个粒子对象。现在需要实现一个ParticleSystem类，用来描述粒子系统本身的行为和属性。对粒子系统抽象成一个类，能够避免在<em>main</em>标签中冗杂的for循环，以及允许一个<em>main</em>标签中定义多个粒子系统。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSysSelf</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  ArrayList&lt;Particle&gt; particles;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// constructor</span></span><br><span class="line">  ParticleSysSelf()</span><br><span class="line">  &#123;</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// +</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// operator</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">    &#123;</span><br><span class="line">      Particle p = it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead())</span><br><span class="line">      &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>⏳ 2022-05-27 16:11</p>
<h2 id="系统的系统">系统的系统</h2>
<p>系统是由一部分基本元素构成的，多个粒子(Particle)对象组成粒子系统(system of particle)，一个粒子系统就是多个粒子对象的集合。当然，粒子系统也可以看作是一个组成更大系统的元素，多个粒子系统的集合就叫粒子系统的系统(system of particle system)。</p>
<h2 id="继承和多态性：介绍">继承和多态性：介绍</h2>
<p>面向对象(object-oriented )编程理论三个基本要素：继承(Inheritance )、多态(Polymorphism)、封装(encapsulation)；</p>
<p>考虑如下的情景，使用processing给你的朋友做一个生日贺卡，生日贺卡是由不同的彩色碎纸组成，这些碎纸有不同的颜色、形状、动作等属性。你可能会想到的解决方案是，先分别实现不同的碎纸类，然后再将这些类组成碎纸系统；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义不同类型的碎纸类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HappyConfetti</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunConfetti</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WackyConfetti</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来实现一个彩色碎纸系统，碎纸系统构造函数中引用不同的碎纸类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  ParticleSystem(<span class="keyword">int</span> num) &#123;</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">      <span class="keyword">float</span> r = random(<span class="number">1</span>);</span><br><span class="line">Randomly picking a <span class="string">&quot;kind&quot;</span> of particle</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span>      (r &lt; <span class="number">0.33</span>) &#123; particles.add(<span class="keyword">new</span> HappyConfetti()); &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (r &lt; <span class="number">0.67</span>) &#123; particles.add(<span class="keyword">new</span> FunConfetti());   &#125;</span><br><span class="line">      <span class="keyword">else</span>               &#123; particles.add(<span class="keyword">new</span> WackyConfetti()); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>上述能够实现想要的功能，但是存在两个问题：</p>
<ol>
<li>实现过程中，会拷贝\粘贴许多重复的代码；</li>
<li>ArrayList不会知道具体是新增的哪个类；</li>
</ol>
<p>要解决问题2可以通过申明不同的类型ArrayList来实现，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;HappyConfetti&gt; a1 = <span class="keyword">new</span> ArrayList&lt;HappyConfetti&gt;();</span><br><span class="line">ArrayList&lt;FunConfetti&gt;   a2 = <span class="keyword">new</span> ArrayList&lt;FunConfetti&gt;();</span><br><span class="line">ArrayList&lt;WackyConfetti&gt; a3 = <span class="keyword">new</span> ArrayList&lt;WackyConfetti&gt;();</span><br></pre></td></tr></table></figure>
<p>这似乎非常不方便，因为我们真的只想要一个列表来跟踪粒子系统中的所有内容。 这可以通过多态性来实现。多态性将允许我们将不同类型的对象视为相同类型并将它们存储在单个 ArrayList 中。</p>
<h2 id="继承基础">继承基础</h2>
<p>让我们举一个不同的例子，动物世界：狗、猫、猴子、熊猫、袋熊和海荨麻。 我们将从编写 Dog 类开始。 Dog 对象将有一个年龄变量（一个整数），以及 eat()、sleep() 和 bark() 函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    Dog()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// constructor</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// eat</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// sleep</span></span><br><span class="line">    &#125;;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// bark</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们实现一个Cat类，该类同样具有Dog类一样的属性和函数，那么代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    Cat()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// constructor</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// eat</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// sleep</span></span><br><span class="line">    &#125;;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">meow</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// bark</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们为鱼、马、考拉和狐猴重写相同的代码时，这个过程将变得相当乏味。 相反，让我们开发一个可以描述任何类型动物的通用 Animal 类。 毕竟，所有的动物都吃和睡。 那么我们可以说：</p>
<ul>
<li>狗是动物，具有动物的所有特性，可以做动物做的所有事情。 此外，狗会吠叫。</li>
<li>猫是动物，具有动物的所有特性，可以做动物做的所有事情。 此外，猫会喵喵叫。</li>
</ul>
<p>继承使这一切成为可能。 通过继承，类可以从其他类继承属性（变量）和功能（方法）。 Dog 类是 Animal 类的子类。 子类会自动继承父类（超类）的所有变量和函数，但也可以包含父类中没有的函数和变量。 就像“生命之树”一样，遗传遵循树形结构。 狗从犬科继承，从哺乳动物继承，从动物继承，等等。</p>
<img src="https://natureofcode.com/book/imgs/chapter04/ch04_02.png">
<p>使用继承的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The Animal class is the parent (or super) class.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Dog and Cat inherit the variable age.</span></span><br><span class="line">  <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">  Animal() &#123;</span><br><span class="line">    age = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//[full] Dog and Cat inherit the functions eat() and sleep().</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;Yum!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;Zzzzzz&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The Dog class is the child (or sub) class, indicated by the code &quot;extends Animal&quot;.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123; <span class="comment">//[bold]</span></span><br><span class="line">  Dog() &#123;</span><br><span class="line">    <span class="comment">// super() executes code found in the parent class.</span></span><br><span class="line">    <span class="keyword">super</span>(); <span class="comment">//[bold]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// We define bark() in the child class, since it isn&#x27;t part of the parent class.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  Cat() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">meow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;MEOW!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继承引入的两个新术语：</p>
<ul>
<li><code>extends </code> 关键字用于表明正在定义的类的父级。 类只能扩展一个类。 但是，类可以扩展其他类的类，即 Dog 扩展 Animal，Terrier 扩展 Dog。</li>
<li><code>super()</code> - 这会调用父类中的构造函数。 换句话说，无论你在父构造函数中做什么，在子构造函数中也一样。 除了 super() 之外，还可以将其他代码写入构造函数。 如果父构造函数定义了匹配的参数，super() 也可以接收参数。</li>
</ul>
<p>子类中可以定义父类中不具有的属性和功能。例如，假设Dog类的对象除了age外还有haircolor属性，并且其是随机的，那么代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">// A child class can introduce new variables not</span></span><br><span class="line">  <span class="comment">// included in the parent.</span></span><br><span class="line">  color haircolor;</span><br><span class="line">  Dog() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    haircolor = color(random(<span class="number">255</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意父类构造函数是如何通过 super() 调用的，它将年龄设置为 0，但是头发颜色是在 Dog类构造函数本身设置的。 如果 Dog 对象与一般 Animal 对象的eat方法不同，则可以通过重写(overwirte)子类中的函数来覆盖父函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  color haircolor;</span><br><span class="line"></span><br><span class="line">  Dog() &#123;</span><br><span class="line">     <span class="keyword">super</span>();</span><br><span class="line">     haircolor = color(random(<span class="number">255</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A child can override a parent function if necessary.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// A Dog&#x27;s specific eating characteristics</span></span><br><span class="line">    println(<span class="string">&quot;Woof! Woof! Slurp.&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，如果Dog类的eat方法和Animal一样，只是有一些额外的功能，子类既可以运行父类的代码，也可以合并自定义代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">   color haircolor;</span><br><span class="line"></span><br><span class="line">   Dog() &#123;</span><br><span class="line">     <span class="keyword">super</span>();</span><br><span class="line">     haircolor = color(random(<span class="number">255</span>));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">// Call eat() from Animal.</span></span><br><span class="line">     <span class="comment">// A child can execute a function from the parent</span></span><br><span class="line">     <span class="comment">// while adding its own code.</span></span><br><span class="line">     <span class="keyword">super</span>.eat(); <span class="comment">//[bold]</span></span><br><span class="line">     <span class="comment">// Add some additional code</span></span><br><span class="line">     <span class="comment">// for a Dog&#x27;s specific eating characteristics.</span></span><br><span class="line">     println(<span class="string">&quot;Woof!!!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">bark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">&quot;WOOF!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="具有继承性的粒子">具有继承性的粒子</h2>
<p>现在我们已经介绍了继承的理论及其语法，我们可以基于已有的Particle 类在 Processing 中开发一个工作示例。</p>
<p>一个简单的粒子类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.05</span>);</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector(random(-<span class="number">1</span>,<span class="number">1</span>),random(-<span class="number">2</span>,<span class="number">0</span>));</span><br><span class="line">    location = l.get();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    update();</span><br><span class="line">    display();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fill(<span class="number">0</span>);</span><br><span class="line">    ellipse(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，我们从 Particle 创建一个子类（我们称之为 Confetti）。 它将从 Particle 继承所有实例变量和方法。 我们编写了一个名为 Confetti 的新构造函数，并通过调用 super() 从父类执行代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Confetti</span> <span class="keyword">extends</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We could add variables for only Confetti here.</span></span><br><span class="line"></span><br><span class="line">  Confetti(PVector l) &#123;</span><br><span class="line">    <span class="keyword">super</span>(l);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// There is no code here because we inherit update() from parent.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//[full] Override the display method.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    rectMode(CENTER);</span><br><span class="line">    fill(<span class="number">175</span>);</span><br><span class="line">    stroke(<span class="number">0</span>);</span><br><span class="line">    rect(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然可以让Confetti类的形式更加复杂，比如让其能够按照一定规律旋转，那么覆写display函数既可以实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">float</span> theta = map(location.x,<span class="number">0</span>,width,<span class="number">0</span>,TWO_PI*<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  rectMode(CENTER);</span><br><span class="line">  fill(<span class="number">0</span>,lifespan);</span><br><span class="line">  stroke(<span class="number">0</span>,lifespan);</span><br><span class="line">	</span><br><span class="line">  pushMatrix();</span><br><span class="line">  translate(location.x,location.y);</span><br><span class="line">  rotate(theta);</span><br><span class="line">  rect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  popMatrix();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们有了一个扩展基本粒子类的 Confetti 类，我们需要弄清楚ParticleSystem 类如何在同一系统中管理不同类型的粒子。 为了实现这个目标，让我们回到动物界继承的例子，看看这个概念是如何延伸到多态世界的。</p>
<h2 id="多态基础">多态基础</h2>
<p>将 一个Dog 对象视为 Dog 类或 Animal 类（其父类）的成员的能力是多态性的一个示例。 <strong>多态性（来自希腊语 polymorphos，意为多种形式）是指以多种形式处理对象的单个实例。</strong> 狗当然是狗，但由于 Dog类继承自 Animal类，它也可以被认为是动物。 在代码中，我们可以两种方式引用它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Dog rover = <span class="keyword">new</span> Dog();</span><br><span class="line">Animal spot = <span class="keyword">new</span> Dog();</span><br></pre></td></tr></table></figure>
<p>尽管第二行代码最初似乎违反了语法规则，但声明 Dog 对象的两种方式都是合法的。 即使我们将 spot 声明为 Animal 对象，我们实际上是在创建 Dog 对象并将其存储在 spot 变量中。 我们可以安全地调用所有 Animal 类方法，因为继承规则规定狗可以做任何动物可以做的事情。  但是，如果 Dog 类覆盖 Animal 类中的 eat() 函数怎么办？ 即使将spot 声明为Animal，Java 也会确定它的真实身份是Dog 并运行适当版本的eat() 函数。 当我们有一个数组或 ArrayList 时，这特别有用。</p>
<h2 id="具有多态性的粒子系统">具有多态性的粒子系统</h2>
<p>让我们暂时假设不存在多态性并重写一个 ParticleSystem 类以包含许多 Particle 对象和许多 Confetti 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">  ArrayList&lt;Particle&gt; particles; <span class="comment">//[bold]</span></span><br><span class="line">  ArrayList&lt;Confetti&gt; confetti; <span class="comment">//[bold]</span></span><br><span class="line">  <span class="comment">//[end]</span></span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;(); <span class="comment">//[bold]</span></span><br><span class="line">    confetti = <span class="keyword">new</span> ArrayList&lt;Confetti&gt;(); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle(origin)); <span class="comment">//[bold]</span></span><br><span class="line">    particles.add(<span class="keyword">new</span> Confetti(origin)); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] We’re stuck doing everything twice with two lists!</span></span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator(); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Particle p = it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    it = confetti.iterator(); <span class="comment">//[bold]</span></span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Confetti c = it.next();</span><br><span class="line">      c.run();</span><br><span class="line">      <span class="keyword">if</span> (c.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意我们有两个单独的列表，一个用于particle，一个用于confetti。 我们想要执行的每个动作都必须执行两次！ 多态性允许我们通过只创建一个包含标准粒子对象和五彩纸屑对象的粒子 ArrayList 来简化上述操作。 我们不必担心哪个是哪个； 这一切都会为我们解决！ （另外，请注意主程序和类的代码并没有改变，所以我们没有在这里包含它。请参阅网站以获取完整示例。）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  <span class="comment">// One list, for anything that is a Particle</span></span><br><span class="line">  <span class="comment">// or extends Particle</span></span><br><span class="line">  ArrayList&lt;Particle&gt; particles;  <span class="comment">//[bold]</span></span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> r = random(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// We have a 50% chance of adding each kind of Particle.</span></span><br><span class="line">    <span class="keyword">if</span> (r &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">      particles.add(<span class="keyword">new</span> Particle(origin));  <span class="comment">//[bold]</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      particles.add(<span class="keyword">new</span> Confetti(origin));  <span class="comment">//[bold]</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      <span class="comment">// Polymorphism allows us to treat everything as a</span></span><br><span class="line">      <span class="comment">// Particle, whether it is a Particle or a Confetti.</span></span><br><span class="line">      Particle p = it.next(); <span class="comment">//[bold]</span></span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="具有力的粒子系统">具有力的粒子系统</h2>
<p>到目前为止，在本章中，我们一直专注于以面向对象的思想来构建代码。 也许您注意到了，或者您没有注意到，但是在此过程中，我们不知不觉地从前章中的位置往后几步（这里指的是对粒子运动复杂性）。 让我们检查一下简单粒子类的构造函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Particle(PVector l) &#123;</span><br><span class="line">  <span class="comment">// We’re setting acceleration to a constant value!</span></span><br><span class="line">  acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.05</span>); <span class="comment">//[bold]</span></span><br><span class="line"></span><br><span class="line">  velocity = <span class="keyword">new</span> PVector(random(-<span class="number">1</span>,<span class="number">1</span>),random(-<span class="number">2</span>,<span class="number">0</span>));</span><br><span class="line">  location = l.get();</span><br><span class="line">  lifespan = <span class="number">255.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>*update()*函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector force)</span> </span>&#123;</span><br><span class="line">  PVector f = force.get();</span><br><span class="line">  f.div(mass);</span><br><span class="line">  acceleration.add(f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了上述代码，可以在*update()*函数中添加一行代码来清除加速度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  velocity.add(acceleration);</span><br><span class="line">  location.add(velocity);</span><br><span class="line">  <span class="comment">// There it is!</span></span><br><span class="line">  acceleration.mult(<span class="number">0</span>);</span><br><span class="line">  lifespan -= <span class="number">2.0</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>添加加速度属性的粒子系统完整代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  PVector velocity;</span><br><span class="line">  PVector acceleration;</span><br><span class="line">  <span class="keyword">float</span> lifespan;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We could vary mass for more interesting results.</span></span><br><span class="line">  <span class="keyword">float</span> mass = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  Particle(PVector l) &#123;</span><br><span class="line">    <span class="comment">// We now start with acceleration of 0.</span></span><br><span class="line">    acceleration = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    velocity = <span class="keyword">new</span> PVector(random(-<span class="number">1</span>,<span class="number">1</span>),random(-<span class="number">2</span>,<span class="number">0</span>));</span><br><span class="line">    location = l.get();</span><br><span class="line">    lifespan = <span class="number">255.0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    update();</span><br><span class="line">    display();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Newton’s second law &amp; force accumulation</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector force)</span> </span>&#123;</span><br><span class="line">    PVector f = force.get();</span><br><span class="line">    f.div(mass);</span><br><span class="line">    acceleration.add(f);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Standard update</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    velocity.add(acceleration);</span><br><span class="line">    location.add(velocity);</span><br><span class="line">    acceleration.mult(<span class="number">0</span>);</span><br><span class="line">    lifespan -= <span class="number">2.0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Our Particle is a circle.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">255</span>,lifespan);</span><br><span class="line">    fill(<span class="number">255</span>,lifespan);</span><br><span class="line">    ellipse(location.x,location.y,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Should the Particle be deleted?</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isDead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lifespan &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，粒子类已经完成，我们有一个非常重要的问题要问。 在哪里调用*applyforce()*函数更为好？ 在粒子类update()代码中，将力施加到粒子上是否合适？ 事实是没有正确或错误的答案； 这实际上取决于特定处理草图的确切功能和目标。 尽管如此，我们仍可以提出一种可能适用于大多数情况的通用解决方案，并制定一个模型，以将力施加到系统中的单个粒子。</p>
<p>让我们考虑以下任务：每次通过*draw()*函数施加一个全局的力到每个粒子上。 使用一个指定下的重力来举例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>);</span><br></pre></td></tr></table></figure>
<p>完整代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">ParticleSystem ps;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Apply a force to all particles.</span></span><br><span class="line">  PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>); </span><br><span class="line">  ps.applyForce(gravity); </span><br><span class="line"></span><br><span class="line">  ps.addParticle();</span><br><span class="line">  ps.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  ArrayList&lt;Particle&gt; particles;</span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle(origin));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector f)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Using an enhanced loop to apply the force to all particles</span></span><br><span class="line">    <span class="keyword">for</span> (Particle p: particles) &#123;</span><br><span class="line">      p.applyForce(f);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  Can’t use the enhanced loop because we want to check for particles to delete.</span></span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Particle p = (Particle) it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="带排斥器的粒子系统">带排斥器的粒子系统</h2>
<p>如果我们想让给这个例子进一步添加一个排斥器(Repeller)对象——第二章中介绍的吸引子(Attractor)的反面，该怎么办？这需要更复杂一点，因为与重力不同，吸引子或排斥器施加在粒子上的每个力都必须针对每个粒子进行计算。</p>
<table><tr>
<td><img src=https://natureofcode.com/book/imgs/chapter04/ch04_03.png border=0></td>
<td><img src=https://natureofcode.com/book/imgs/chapter04/ch04_04.png border=0></td>
</tr></table>
<p>让我们通过检查如何将新的 Repeller 对象合并到对简单粒子系统施力的示例中来开始解决这个问题。 需要在代码中添加两个主要内容：</p>
<ol>
<li>一个 Repeller 对象（声明、初始化和显示）。</li>
<li>将 Repeller 对象传递到 ParticleSystem 的函数，以便它可以对每个粒子对象施加力。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ParticleSystem ps;</span><br><span class="line"><span class="comment">// New thing: we declare a Repeller object.</span></span><br><span class="line">Repeller repeller; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>));</span><br><span class="line">  <span class="comment">//  initialize a Repeller object.</span></span><br><span class="line">  repeller = <span class="keyword">new</span> Repeller(width/<span class="number">2</span>-<span class="number">20</span>,height/<span class="number">2</span>); <span class="comment">//[bold]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">100</span>);</span><br><span class="line">  ps.addParticle();</span><br><span class="line"></span><br><span class="line">  PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">  <span class="comment">// apply gravity to every particle in  system of particle</span></span><br><span class="line">  ps.applyForce(gravity);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// New thing: apply a force from a repeller.</span></span><br><span class="line">  ps.applyRepeller(repeller); <span class="comment">//[bold]</span></span><br><span class="line"></span><br><span class="line">  ps.run();</span><br><span class="line">  <span class="comment">//  we display the Repeller object.</span></span><br><span class="line">  repeller.display();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Repeller类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeller</span> </span>&#123;</span><br><span class="line">  PVector location;</span><br><span class="line">  <span class="keyword">float</span> r = <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line">  Repeller(<span class="keyword">float</span> x, <span class="keyword">float</span> y)  &#123;</span><br><span class="line">    location = <span class="keyword">new</span> PVector(x,y);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">255</span>);</span><br><span class="line">    fill(<span class="number">255</span>);</span><br><span class="line">    ellipse(location.x,location.y,r*<span class="number">2</span>,r*<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更难的问题是，在粒子系统类中如何编写 applyRepeller() 函数？ 与将 PVector 传递给函数的applyForce() 不同， applyRepeller()需要将 Repeller 对象传递到函数中，并在函数中完成计算 repeller 和所有粒子之间的力。首先来看一下两个函数各自需要具有的功能：</p>
<table class="code">
<tbody><tr>
<th>applyForce()</th>
<th>applyRepeller</th>
</tr>
<tr>
<td>
<pre>void applyForce(PVector f) {
  for (Particle p: particles) {
    p.applyForce(f);
  }
}
</pre>
</td>
<td>
<pre>void applyRepeller(Repeller r) {
  for (Particle p: particles) {
    PVector force = r.repel(p);
    p.applyForce(force);
  }
}
</pre>
</td>
</tr>
</tbody></table>
<p>功能几乎相同。 只有两个区别。</p>
<ol>
<li>函数的参数不同，一个是Repeller对象，一个是PVector对象。</li>
<li>必须为每个粒子单独计算力(PVector)并将其作用到粒子上。</li>
</ol>
<p>这个力是如何计算的？在repel() 的函数中，它是我们为 Attractor 类编写的吸引函数的反函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">PVector <span class="title">repel</span><span class="params">(Particle p)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1) Get force direction.</span></span><br><span class="line">    PVector dir =</span><br><span class="line">        PVector.sub(location,p.location);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2) Get distance (constrain distance).</span></span><br><span class="line">    <span class="keyword">float</span> d = dir.mag();</span><br><span class="line">    d = constrain(d,<span class="number">5</span>,<span class="number">100</span>);</span><br><span class="line">  </span><br><span class="line">    dir.normalize();</span><br><span class="line">    <span class="comment">// 3) Calculate magnitude.</span></span><br><span class="line">    <span class="keyword">float</span> force = -<span class="number">1</span> * G / (d * d);</span><br><span class="line">    <span class="comment">// 4) Make a vector out of direction and magnitude.</span></span><br><span class="line">    dir.mult(force);</span><br><span class="line">    <span class="keyword">return</span> dir;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述添加排斥器的整个过程中，我们从未考虑过改变Particle类本身。 粒子实际上并不需要知道任何关于其类细节的信息。 它只需要管理它的位置、速度和加速度，并具有接收外力并对其施加作用的能力。 因此，我们现在可以完整地查看这个示例，再次省略没有更改的 Particle 类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// One ParticleSystem</span></span><br><span class="line">ParticleSystem ps;</span><br><span class="line"><span class="comment">// One repeller</span></span><br><span class="line">Repeller repeller;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  size(<span class="number">640</span>,<span class="number">360</span>);</span><br><span class="line">  ps = <span class="keyword">new</span> ParticleSystem(<span class="keyword">new</span> PVector(width/<span class="number">2</span>,<span class="number">50</span>));</span><br><span class="line">  repeller = <span class="keyword">new</span> Repeller(width/<span class="number">2</span>-<span class="number">20</span>,height/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  background(<span class="number">100</span>);</span><br><span class="line">  ps.addParticle();</span><br><span class="line">  <span class="comment">// We’re applying a universal gravity.</span></span><br><span class="line">  PVector gravity = <span class="keyword">new</span> PVector(<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">  ps.applyForce(gravity);</span><br><span class="line">  <span class="comment">// Applying the repeller</span></span><br><span class="line">  ps.applyRepeller(repeller);</span><br><span class="line"></span><br><span class="line">  ps.run();</span><br><span class="line">  repeller.display();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The ParticleSystem manages all the Particles.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParticleSystem</span> </span>&#123;</span><br><span class="line">  ArrayList&lt;Particle&gt; particles;</span><br><span class="line">  PVector origin;</span><br><span class="line"></span><br><span class="line">  ParticleSystem(PVector location) &#123;</span><br><span class="line">    origin = location.get();</span><br><span class="line">    particles = <span class="keyword">new</span> ArrayList&lt;Particle&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addParticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    particles.add(<span class="keyword">new</span> Particle(origin));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Applying a force as a PVector</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyForce</span><span class="params">(PVector f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Particle p: particles) &#123;</span><br><span class="line">      p.applyForce(f);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">applyRepeller</span><span class="params">(Repeller r)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//[full] Calculating a force for each Particle based on a Repeller</span></span><br><span class="line">    <span class="keyword">for</span> (Particle p: particles) &#123;</span><br><span class="line">      PVector force = r.repel(p);</span><br><span class="line">      p.applyForce(force);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Iterator&lt;Particle&gt; it = particles.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">      Particle p = (Particle) it.next();</span><br><span class="line">      p.run();</span><br><span class="line">      <span class="keyword">if</span> (p.isDead()) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// How strong is the repeller?</span></span><br><span class="line">  <span class="keyword">float</span> strength = <span class="number">100</span>;</span><br><span class="line">  PVector location;</span><br><span class="line">  <span class="keyword">float</span> r = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Repeller(<span class="keyword">float</span> x, <span class="keyword">float</span> y)  &#123;</span><br><span class="line">    location = <span class="keyword">new</span> PVector(x,y);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    stroke(<span class="number">255</span>);</span><br><span class="line">    fill(<span class="number">255</span>);</span><br><span class="line">    ellipse(location.x,location.y,r*<span class="number">2</span>,r*<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">PVector <span class="title">repel</span><span class="params">(Particle p)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// This is the same repel algorithm we used in Chapter 2: forces based on gravitational attraction.</span></span><br><span class="line">    PVector dir = PVector.sub(location,p.location);</span><br><span class="line">    <span class="keyword">float</span> d = dir.mag();</span><br><span class="line">    dir.normalize();</span><br><span class="line">    d = constrain(d,<span class="number">5</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">float</span> force = -<span class="number">1</span> * strength / (d * d);</span><br><span class="line">    dir.mult(force);</span><br><span class="line">    <span class="keyword">return</span> dir;</span><br><span class="line">    <span class="comment">//[end]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="图像纹理和加性混合">图像纹理和加性混合</h2>
<p>尽管这本书实际上是关于行为和算法而不是计算机图形和设计，但我认为如果我们讨论粒子系统并且从未看过涉及每个纹理的示例，我们将无法忍受自己带有图像的粒子。 就设计某些类型的视觉效果而言，选择绘制粒子的方式是难题的重要组成部分。</p>
<p>这两个图像都是由相同的算法生成的。 唯一的区别是在图像 A 中为每个粒子绘制了一个白色圆圈，而在 B 中为每个粒子绘制了一个“模糊”斑点。</p>
<img src="https://natureofcode.com/book/imgs/chapter04/ch04_05.png">
<p>在你编写任何代码之前，需要先制作图像纹理！建议使用 PNG 格式，因为在绘制图像时将保留 alpha 通道（即透明度），这是将纹理混合为相互叠加的粒子层所必需的。</p>
<hr>
<p>By W.h. 2022-06-15 11:28:39</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-士兵突击—不一样的兵王的故事"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/%E5%A3%AB%E5%85%B5%E7%AA%81%E5%87%BB%E2%80%94%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%85%B5%E7%8E%8B%E7%9A%84%E6%95%85%E4%BA%8B/"
    >士兵突击—不是一个兵王的故事</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/%E5%A3%AB%E5%85%B5%E7%AA%81%E5%87%BB%E2%80%94%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%85%B5%E7%8E%8B%E7%9A%84%E6%95%85%E4%BA%8B/" class="article-date">
  <time datetime="2022-04-27T00:39:02.000Z" itemprop="datePublished">2022-04-27</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="人性">人性</h2>
<p>1、遵守是一种惯性，散漫也是一种惯性，人是适应性很强的生物，能适应懒散的惯性也能适应积极的惯性，如果你还能碰到给你惯性的人。</p>
<p>2、团结就是从众，从众就是迁就集体的底线，底线就是一根一直掉深不见底的线；</p>
<p>3、坚持分很多种，有一种我们比较熟悉，就是把全世界推到自己的对立面，把所有投来的目光视为毒箭，做事为打脸，怨恨当源泉。</p>
<p>4、自卑和怯懦的人在面对新环境时会长期的观察和揣度，表现为一种木讷，这种环境下也会习惯性地求助于一个兄长的角色，又往往失了分寸。</p>
<p>5、人活的是情感，不是道理。</p>
<h2 id="成长">成长</h2>
<p>1、人这辈子好像一定会遇到这种时候，没人关心、没人搭理，一天天下来有些浑浑噩噩，刚开始还想想事，到最后终于放弃计划，不再去度量时间。</p>
<p>2、日子就是问题叠着问题。</p>
<p>3、因循一个结果，盘出一个原因。</p>
<p>4、贵人——善良会吸引善良，只要你也是善良的。</p>
<p>5、他所做的每件小事就好像抓住一棵救命稻草一样，到最后你才发现，他抱住的已经是参天大树了。</p>
<div style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/Joiner12/PicBed@main/image-20210925144410107.png"><br>
  <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1o34y1Q7LM" style="color:#63A5E0;">《士兵突击》——不是一个兵王的故事网页链接码</a>
  <br>
</div>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/%E9%9A%8F%E6%83%B3/" rel="tag">随想</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-《人世间-摘抄》"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/%E3%80%8A%E4%BA%BA%E4%B8%96%E9%97%B4-%E6%91%98%E6%8A%84%E3%80%8B/"
    >《人世间》 摘抄</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/%E3%80%8A%E4%BA%BA%E4%B8%96%E9%97%B4-%E6%91%98%E6%8A%84%E3%80%8B/" class="article-date">
  <time datetime="2022-04-26T03:17:37.000Z" itemprop="datePublished">2022-04-26</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <img src="https://cdn.jsdelivr.net/gh/Joiner12/PicBed@main/%E8%BE%9B%E5%BC%83%E7%96%BE.PNG" alt="辛弃疾" style="zoom: 50%;" />
<div>
    <p style="font-size:22px;font-family:楷体;font-weight:bold;">《人世间》于我，是一本很好的书。平凡、真实、伟大；故事讲述的一个东北普通家庭从文化大革命到改革开放40多年后的今天家庭发展历程。因为真实，自然就平凡，于平凡中显精神之伟大。<br>
    借用题记：“于人间烟火处彰显道义和担当，于悲欢离合中，抒写情怀和热望。”</p>
</div> 
      <a class="article-more-link" href="undefined/%E3%80%8A%E4%BA%BA%E4%B8%96%E9%97%B4-%E6%91%98%E6%8A%84%E3%80%8B/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-搜索技巧"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/"
    >搜索技巧</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" class="article-date">
  <time datetime="2022-03-19T07:05:16.000Z" itemprop="datePublished">2022-03-19</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <img src="https://cdn.jsdelivr.net/gh/Joiner12/PicBed@main/1c7a57458a2d4281a12bb816f51e2876.PNG"> 
      <a class="article-more-link" href="undefined/%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/search/" rel="tag">search</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-classification-using-nearest-neighbors-instruction-matlab"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="undefined/classification-using-nearest-neighbors-instruction-matlab/"
    >MATLAB近邻算法分类指南</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="undefined/classification-using-nearest-neighbors-instruction-matlab/" class="article-date">
  <time datetime="2022-01-11T07:11:39.000Z" itemprop="datePublished">2022-01-11</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <div style="text-align:center;">
    <img src="https://cdn.jsdelivr.net/gh/Joiner12/PicBed@main/KNN-1.gif" style="width:400px;height:250px;">
</div> 
      <a class="article-more-link" href="undefined/classification-using-nearest-neighbors-instruction-matlab/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/algorithm/" rel="tag">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/kNN/" rel="tag">kNN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/matlab/" rel="tag">matlab</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="archives/2/">2</a><a class="extend next" rel="next" href="archives/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2023
        <i class="ri-heart-fill heart_icon"></i> Wh
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="index.html"><img src="/img/avatar/favicon-32x32-monkey.png" alt="Wh&#39;s 🛰️ Blogs"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="index.html">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://shenyu-vip.lofter.com/">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.staticfile.org/mathjax/2.7.7/MathJax.js"></script>
<script src="https://cdn.staticfile.org/mathjax/2.7.7/config/TeX-AMS-MML_HTMLorMML-full.js"></script>
<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

</html>